from numpy import einsum
from numpy.typing import NDArray
from chem.hf.intermediates_builders import Intermediates
from chem.ccsd.uhf_ccsd import UHF_CCSD_Data


def get_lambda_doubles_res_aaaa(
    uhf_scf_data: Intermediates,
    uhf_ccsd_data: UHF_CCSD_Data,
) -> NDArray:
    f_aa = uhf_scf_data.f_aa
    f_bb = uhf_scf_data.f_bb
    g_aaaa = uhf_scf_data.g_aaaa
    g_abab = uhf_scf_data.g_abab
    g_bbbb = uhf_scf_data.g_bbbb
    va = uhf_scf_data.va
    vb = uhf_scf_data.vb
    oa = uhf_scf_data.oa
    ob = uhf_scf_data.ob
    t1_aa = uhf_ccsd_data.t1_aa
    t1_bb = uhf_ccsd_data.t1_bb
    t2_aaaa = uhf_ccsd_data.t2_aaaa
    t2_abab = uhf_ccsd_data.t2_abab
    t2_bbbb = uhf_ccsd_data.t2_bbbb
    if uhf_ccsd_data.lmbda is None:
        raise RuntimeError("Lambda amplitues missing in UHF_CCSD_Data")
    l1_aa = uhf_ccsd_data.lmbda.l1_aa
    l1_bb = uhf_ccsd_data.lmbda.l1_bb
    l2_aaaa = uhf_ccsd_data.lmbda.l2_aaaa
    l2_abab = uhf_ccsd_data.lmbda.l2_abab
    l2_bbbb = uhf_ccsd_data.lmbda.l2_bbbb
    
    contracted_intermediate = -1.00 * einsum('ja,ib->ijab', f_aa[oa, va], l1_aa)
    lambda_doubles_res_aaaa =  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate)  + -1.00000 * einsum('ijab->ijba', contracted_intermediate)  +  1.00000 * einsum('ijab->jiba', contracted_intermediate) 
    lambda_doubles_res_aaaa +=  1.00 * einsum('kk,ijab->ijab', f_aa[oa, oa], l2_aaaa)
    lambda_doubles_res_aaaa +=  1.00 * einsum('kk,ijab->ijab', f_bb[ob, ob], l2_aaaa)
    contracted_intermediate = -1.00 * einsum('jk,ikab->ijab', f_aa[oa, oa], l2_aaaa)
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('ca,ijcb->ijab', f_aa[va, va], l2_aaaa)
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->ijba', contracted_intermediate) 
    lambda_doubles_res_aaaa +=  1.00 * einsum('kc,ck,ijab->ijab', f_aa[oa, va], t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00 * einsum('kc,ck,ijab->ijab', f_bb[ob, vb], t1_bb, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    contracted_intermediate = -1.00 * einsum('jc,ck,ikab->ijab', f_aa[oa, va], t1_aa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('ka,ck,ijcb->ijab', f_aa[oa, va], t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->ijba', contracted_intermediate) 
    lambda_doubles_res_aaaa += -0.50 * einsum('lklk,ijab->ijab', g_aaaa[oa, oa, oa, oa], l2_aaaa)
    lambda_doubles_res_aaaa += -0.50 * einsum('lklk,ijab->ijab', g_abab[oa, ob, oa, ob], l2_aaaa)
    lambda_doubles_res_aaaa += -0.50 * einsum('klkl,ijab->ijab', g_abab[oa, ob, oa, ob], l2_aaaa)
    lambda_doubles_res_aaaa += -0.50 * einsum('lklk,ijab->ijab', g_bbbb[ob, ob, ob, ob], l2_aaaa)
    lambda_doubles_res_aaaa +=  1.00 * einsum('ijab->ijab', g_aaaa[oa, oa, va, va])
    contracted_intermediate = -1.00 * einsum('ijak,kb->ijab', g_aaaa[oa, oa, va, oa], l1_aa)
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->ijba', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('jcab,ic->ijab', g_aaaa[oa, va, va, va], l1_aa)
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate) 
    lambda_doubles_res_aaaa +=  0.50 * einsum('ijkl,klab->ijab', g_aaaa[oa, oa, oa, oa], l2_aaaa)
    contracted_intermediate =  1.00 * einsum('jcak,ikcb->ijab', g_aaaa[oa, va, va, oa], l2_aaaa)
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate)  + -1.00000 * einsum('ijab->ijba', contracted_intermediate)  +  1.00000 * einsum('ijab->jiba', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('jcak,ikbc->ijab', g_abab[oa, vb, va, ob], l2_abab)
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate)  + -1.00000 * einsum('ijab->ijba', contracted_intermediate)  +  1.00000 * einsum('ijab->jiba', contracted_intermediate) 
    lambda_doubles_res_aaaa +=  0.50 * einsum('dcab,ijdc->ijab', g_aaaa[va, va, va, va], l2_aaaa)
    contracted_intermediate =  1.00 * einsum('jkca,ck,ib->ijab', g_aaaa[oa, oa, va, va], t1_aa, l1_aa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate)  + -1.00000 * einsum('ijab->ijba', contracted_intermediate)  +  1.00000 * einsum('ijab->jiba', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('jkac,ck,ib->ijab', g_abab[oa, ob, va, vb], t1_bb, l1_aa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate)  + -1.00000 * einsum('ijab->ijba', contracted_intermediate)  +  1.00000 * einsum('ijab->jiba', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('ijca,ck,kb->ijab', g_aaaa[oa, oa, va, va], t1_aa, l1_aa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->ijba', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jkab,ck,ic->ijab', g_aaaa[oa, oa, va, va], t1_aa, l1_aa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jlck,cl,ikab->ijab', g_aaaa[oa, oa, va, oa], t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('jlkc,cl,ikab->ijab', g_abab[oa, ob, oa, vb], t1_bb, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate) 
    lambda_doubles_res_aaaa +=  1.00 * einsum('ijcl,ck,klab->ijab', g_aaaa[oa, oa, va, oa], t1_aa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    contracted_intermediate = -1.00 * einsum('jlak,cl,ikcb->ijab', g_aaaa[oa, oa, va, oa], t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate)  + -1.00000 * einsum('ijab->ijba', contracted_intermediate)  +  1.00000 * einsum('ijab->jiba', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jlak,cl,ikbc->ijab', g_abab[oa, ob, va, ob], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate)  + -1.00000 * einsum('ijab->ijba', contracted_intermediate)  +  1.00000 * einsum('ijab->jiba', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('kcda,dk,ijcb->ijab', g_aaaa[oa, va, va, va], t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->ijba', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('ckad,dk,ijcb->ijab', g_abab[va, ob, va, vb], t1_bb, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->ijba', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('jcda,dk,ikcb->ijab', g_aaaa[oa, va, va, va], t1_aa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate)  + -1.00000 * einsum('ijab->ijba', contracted_intermediate)  +  1.00000 * einsum('ijab->jiba', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('jcad,dk,ikbc->ijab', g_abab[oa, vb, va, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate)  + -1.00000 * einsum('ijab->ijba', contracted_intermediate)  +  1.00000 * einsum('ijab->jiba', contracted_intermediate) 
    lambda_doubles_res_aaaa +=  1.00 * einsum('kdab,ck,ijdc->ijab', g_aaaa[oa, va, va, va], t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  0.250 * einsum('lkcd,cdlk,ijab->ijab', g_aaaa[oa, oa, va, va], t2_aaaa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  0.250 * einsum('lkcd,cdlk,ijab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  0.250 * einsum('klcd,cdkl,ijab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  0.250 * einsum('lkdc,dclk,ijab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  0.250 * einsum('kldc,dckl,ijab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  0.250 * einsum('lkcd,cdlk,ijab->ijab', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    contracted_intermediate = -0.50 * einsum('jlcd,cdkl,ikab->ijab', g_aaaa[oa, oa, va, va], t2_aaaa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate) 
    contracted_intermediate = -0.50 * einsum('jlcd,cdkl,ikab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate) 
    contracted_intermediate = -0.50 * einsum('jldc,dckl,ikab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate) 
    lambda_doubles_res_aaaa +=  0.250 * einsum('ijcd,cdkl,klab->ijab', g_aaaa[oa, oa, va, va], t2_aaaa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    contracted_intermediate = -0.50 * einsum('lkda,dclk,ijcb->ijab', g_aaaa[oa, oa, va, va], t2_aaaa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->ijba', contracted_intermediate) 
    contracted_intermediate = -0.50 * einsum('lkad,cdlk,ijcb->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->ijba', contracted_intermediate) 
    contracted_intermediate = -0.50 * einsum('klad,cdkl,ijcb->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->ijba', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jlda,dckl,ikcb->ijab', g_aaaa[oa, oa, va, va], t2_aaaa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate)  + -1.00000 * einsum('ijab->ijba', contracted_intermediate)  +  1.00000 * einsum('ijab->jiba', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jlda,dclk,ikbc->ijab', g_aaaa[oa, oa, va, va], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate)  + -1.00000 * einsum('ijab->ijba', contracted_intermediate)  +  1.00000 * einsum('ijab->jiba', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jlad,cdkl,ikcb->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate)  + -1.00000 * einsum('ijab->ijba', contracted_intermediate)  +  1.00000 * einsum('ijab->jiba', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jlad,dckl,ikbc->ijab', g_abab[oa, ob, va, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate)  + -1.00000 * einsum('ijab->ijba', contracted_intermediate)  +  1.00000 * einsum('ijab->jiba', contracted_intermediate) 
    contracted_intermediate = -0.50 * einsum('ijda,dckl,klcb->ijab', g_aaaa[oa, oa, va, va], t2_aaaa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->ijba', contracted_intermediate) 
    contracted_intermediate =  0.50 * einsum('ijda,dckl,klbc->ijab', g_aaaa[oa, oa, va, va], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->ijba', contracted_intermediate) 
    contracted_intermediate =  0.50 * einsum('ijda,dclk,lkbc->ijab', g_aaaa[oa, oa, va, va], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->ijba', contracted_intermediate) 
    lambda_doubles_res_aaaa +=  0.250 * einsum('lkab,dclk,ijdc->ijab', g_aaaa[oa, oa, va, va], t2_aaaa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    contracted_intermediate = -0.50 * einsum('jlab,dckl,ikdc->ijab', g_aaaa[oa, oa, va, va], t2_aaaa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate) 
    contracted_intermediate =  0.50 * einsum('jlab,dclk,ikdc->ijab', g_aaaa[oa, oa, va, va], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate) 
    contracted_intermediate =  0.50 * einsum('jlab,cdlk,ikcd->ijab', g_aaaa[oa, oa, va, va], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate) 
    lambda_doubles_res_aaaa += -0.50 * einsum('lkcd,ck,dl,ijab->ijab', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_aaaa +=  0.50 * einsum('klcd,ck,dl,ijab->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_aaaa +=  0.50 * einsum('lkdc,ck,dl,ijab->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_aaaa += -0.50 * einsum('lkcd,ck,dl,ijab->ijab', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    contracted_intermediate =  1.00 * einsum('jlcd,cl,dk,ikab->ijab', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('jldc,cl,dk,ikab->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('lkda,cl,dk,ijcb->ijab', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_aaaa, optimize=['einsum_path', (0, 2), (0, 2), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->ijba', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('lkad,cl,dk,ijcb->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_aaaa, optimize=['einsum_path', (0, 2), (0, 2), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->ijba', contracted_intermediate) 
    lambda_doubles_res_aaaa += -0.50 * einsum('ijcd,cl,dk,klab->ijab', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_aaaa, optimize=['einsum_path', (1, 3), (1, 2), (0, 1)])
    contracted_intermediate =  1.00 * einsum('jlda,cl,dk,ikcb->ijab', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate)  + -1.00000 * einsum('ijab->ijba', contracted_intermediate)  +  1.00000 * einsum('ijab->jiba', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jlad,cl,dk,ikbc->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate)  + -1.00000 * einsum('ijab->ijba', contracted_intermediate)  +  1.00000 * einsum('ijab->jiba', contracted_intermediate) 
    lambda_doubles_res_aaaa += -0.50 * einsum('lkab,cl,dk,ijdc->ijab', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    return lambda_doubles_res_aaaa


def get_lambda_doubles_res_abab(
    uhf_scf_data: Intermediates,
    uhf_ccsd_data: UHF_CCSD_Data,
) -> NDArray:
    f_aa = uhf_scf_data.f_aa
    f_bb = uhf_scf_data.f_bb
    g_aaaa = uhf_scf_data.g_aaaa
    g_abab = uhf_scf_data.g_abab
    g_bbbb = uhf_scf_data.g_bbbb
    va = uhf_scf_data.va
    vb = uhf_scf_data.vb
    oa = uhf_scf_data.oa
    ob = uhf_scf_data.ob
    t1_aa = uhf_ccsd_data.t1_aa
    t1_bb = uhf_ccsd_data.t1_bb
    t2_aaaa = uhf_ccsd_data.t2_aaaa
    t2_abab = uhf_ccsd_data.t2_abab
    t2_bbbb = uhf_ccsd_data.t2_bbbb
    if uhf_ccsd_data.lmbda is None:
        raise RuntimeError("Lambda amplitues missing in UHF_CCSD_Data")
    l1_aa = uhf_ccsd_data.lmbda.l1_aa
    l1_bb = uhf_ccsd_data.lmbda.l1_bb
    l2_aaaa = uhf_ccsd_data.lmbda.l2_aaaa
    l2_abab = uhf_ccsd_data.lmbda.l2_abab
    l2_bbbb = uhf_ccsd_data.lmbda.l2_bbbb
    
    lambda_doubles_res_abab =  1.00 * einsum('jb,ia->ijab', f_bb[ob, vb], l1_aa)
    lambda_doubles_res_abab +=  1.00 * einsum('ia,jb->ijab', f_aa[oa, va], l1_bb)
    lambda_doubles_res_abab +=  1.00 * einsum('kk,ijab->ijab', f_aa[oa, oa], l2_abab)
    lambda_doubles_res_abab +=  1.00 * einsum('kk,ijab->ijab', f_bb[ob, ob], l2_abab)
    lambda_doubles_res_abab += -1.00 * einsum('jk,ikab->ijab', f_bb[ob, ob], l2_abab)
    lambda_doubles_res_abab += -1.00 * einsum('ik,kjab->ijab', f_aa[oa, oa], l2_abab)
    lambda_doubles_res_abab +=  1.00 * einsum('ca,ijcb->ijab', f_aa[va, va], l2_abab)
    lambda_doubles_res_abab +=  1.00 * einsum('cb,ijac->ijab', f_bb[vb, vb], l2_abab)
    lambda_doubles_res_abab +=  1.00 * einsum('kc,ck,ijab->ijab', f_aa[oa, va], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('kc,ck,ijab->ijab', f_bb[ob, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('jc,ck,ikab->ijab', f_bb[ob, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('ic,ck,kjab->ijab', f_aa[oa, va], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('ka,ck,ijcb->ijab', f_aa[oa, va], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('kb,ck,ijac->ijab', f_bb[ob, vb], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('lklk,ijab->ijab', g_aaaa[oa, oa, oa, oa], l2_abab)
    lambda_doubles_res_abab += -0.50 * einsum('lklk,ijab->ijab', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_abab += -0.50 * einsum('klkl,ijab->ijab', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_abab += -0.50 * einsum('lklk,ijab->ijab', g_bbbb[ob, ob, ob, ob], l2_abab)
    lambda_doubles_res_abab +=  1.00 * einsum('ijab->ijab', g_abab[oa, ob, va, vb])
    lambda_doubles_res_abab += -1.00 * einsum('ijak,kb->ijab', g_abab[oa, ob, va, ob], l1_bb)
    lambda_doubles_res_abab += -1.00 * einsum('ijkb,ka->ijab', g_abab[oa, ob, oa, vb], l1_aa)
    lambda_doubles_res_abab +=  1.00 * einsum('cjab,ic->ijab', g_abab[va, ob, va, vb], l1_aa)
    lambda_doubles_res_abab +=  1.00 * einsum('icab,jc->ijab', g_abab[oa, vb, va, vb], l1_bb)
    lambda_doubles_res_abab +=  0.50 * einsum('ijkl,klab->ijab', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_abab +=  0.50 * einsum('ijlk,lkab->ijab', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_abab += -1.00 * einsum('cjak,ikcb->ijab', g_abab[va, ob, va, ob], l2_abab)
    lambda_doubles_res_abab += -1.00 * einsum('cjkb,ikca->ijab', g_abab[va, ob, oa, vb], l2_aaaa)
    lambda_doubles_res_abab +=  1.00 * einsum('jcbk,ikac->ijab', g_bbbb[ob, vb, vb, ob], l2_abab)
    lambda_doubles_res_abab +=  1.00 * einsum('icak,kjcb->ijab', g_aaaa[oa, va, va, oa], l2_abab)
    lambda_doubles_res_abab += -1.00 * einsum('icak,jkcb->ijab', g_abab[oa, vb, va, ob], l2_bbbb)
    lambda_doubles_res_abab += -1.00 * einsum('ickb,kjac->ijab', g_abab[oa, vb, oa, vb], l2_abab)
    lambda_doubles_res_abab +=  0.50 * einsum('dcab,ijdc->ijab', g_abab[va, vb, va, vb], l2_abab)
    lambda_doubles_res_abab +=  0.50 * einsum('cdab,ijcd->ijab', g_abab[va, vb, va, vb], l2_abab)
    lambda_doubles_res_abab +=  1.00 * einsum('kjcb,ck,ia->ijab', g_abab[oa, ob, va, vb], t1_aa, l1_aa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('jkcb,ck,ia->ijab', g_bbbb[ob, ob, vb, vb], t1_bb, l1_aa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('ikca,ck,jb->ijab', g_aaaa[oa, oa, va, va], t1_aa, l1_bb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ikac,ck,jb->ijab', g_abab[oa, ob, va, vb], t1_bb, l1_bb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('ijac,ck,kb->ijab', g_abab[oa, ob, va, vb], t1_bb, l1_bb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('ijcb,ck,ka->ijab', g_abab[oa, ob, va, vb], t1_aa, l1_aa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('kjab,ck,ic->ijab', g_abab[oa, ob, va, vb], t1_aa, l1_aa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('ikab,ck,jc->ijab', g_abab[oa, ob, va, vb], t1_bb, l1_bb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('ljck,cl,ikab->ijab', g_abab[oa, ob, va, ob], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('jlck,cl,ikab->ijab', g_bbbb[ob, ob, vb, ob], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ilck,cl,kjab->ijab', g_aaaa[oa, oa, va, oa], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('ilkc,cl,kjab->ijab', g_abab[oa, ob, oa, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ijcl,ck,klab->ijab', g_abab[oa, ob, va, ob], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ijlc,ck,lkab->ijab', g_abab[oa, ob, oa, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ljak,cl,ikcb->ijab', g_abab[oa, ob, va, ob], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ljkb,cl,ikca->ijab', g_abab[oa, ob, oa, vb], t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('jlbk,cl,ikac->ijab', g_bbbb[ob, ob, vb, ob], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('ilak,cl,kjcb->ijab', g_aaaa[oa, oa, va, oa], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ilak,cl,jkcb->ijab', g_abab[oa, ob, va, ob], t1_bb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ilkb,cl,kjac->ijab', g_abab[oa, ob, oa, vb], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('kcda,dk,ijcb->ijab', g_aaaa[oa, va, va, va], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ckad,dk,ijcb->ijab', g_abab[va, ob, va, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('kcdb,dk,ijac->ijab', g_abab[oa, vb, va, vb], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('kcdb,dk,ijac->ijab', g_bbbb[ob, vb, vb, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('cjad,dk,ikcb->ijab', g_abab[va, ob, va, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('cjdb,dk,ikca->ijab', g_abab[va, ob, va, vb], t1_aa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('jcdb,dk,ikac->ijab', g_bbbb[ob, vb, vb, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('icda,dk,kjcb->ijab', g_aaaa[oa, va, va, va], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('icad,dk,jkcb->ijab', g_abab[oa, vb, va, vb], t1_bb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('icdb,dk,kjac->ijab', g_abab[oa, vb, va, vb], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('kdab,ck,ijcd->ijab', g_abab[oa, vb, va, vb], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('dkab,ck,ijdc->ijab', g_abab[va, ob, va, vb], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab +=  0.250 * einsum('lkcd,cdlk,ijab->ijab', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.250 * einsum('lkcd,cdlk,ijab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.250 * einsum('klcd,cdkl,ijab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.250 * einsum('lkdc,dclk,ijab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.250 * einsum('kldc,dckl,ijab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.250 * einsum('lkcd,cdlk,ijab->ijab', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('ljcd,cdlk,ikab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('ljdc,dclk,ikab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('jlcd,cdkl,ikab->ijab', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('ilcd,cdkl,kjab->ijab', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('ilcd,cdkl,kjab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('ildc,dckl,kjab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.250 * einsum('ijcd,cdkl,klab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.250 * einsum('ijcd,cdlk,lkab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.250 * einsum('ijdc,dckl,klab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.250 * einsum('ijdc,dclk,lkab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('lkda,dclk,ijcb->ijab', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('lkad,cdlk,ijcb->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('klad,cdkl,ijcb->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('lkdb,dclk,ijac->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('kldb,dckl,ijac->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('lkdb,dclk,ijac->ijab', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ljad,cdlk,ikcb->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ljdb,dckl,ikca->ijab', g_abab[oa, ob, va, vb], t2_aaaa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ljdb,dclk,ikac->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('jldb,cdkl,ikca->ijab', g_bbbb[ob, ob, vb, vb], t2_abab, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('jldb,dckl,ikac->ijab', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ilda,dckl,kjcb->ijab', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ilda,dclk,jkcb->ijab', g_aaaa[oa, oa, va, va], t2_abab, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ilad,cdkl,kjcb->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ilad,dckl,jkcb->ijab', g_abab[oa, ob, va, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ildb,dckl,kjac->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('ijad,cdkl,klcb->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('ijad,cdlk,lkcb->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab +=  0.50 * einsum('ijad,dckl,klcb->ijab', g_abab[oa, ob, va, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab +=  0.50 * einsum('ijdb,dckl,klca->ijab', g_abab[oa, ob, va, vb], t2_aaaa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('ijdb,dckl,klac->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('ijdb,dclk,lkac->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab +=  0.250 * einsum('lkab,dclk,ijdc->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.250 * einsum('klab,dckl,ijdc->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.250 * einsum('lkab,cdlk,ijcd->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.250 * einsum('klab,cdkl,ijcd->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.50 * einsum('ljab,dckl,ikdc->ijab', g_abab[oa, ob, va, vb], t2_aaaa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('ljab,dclk,ikdc->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('ljab,cdlk,ikcd->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('ilab,dckl,kjdc->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('ilab,cdkl,kjcd->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab +=  0.50 * einsum('ilab,dckl,jkdc->ijab', g_abab[oa, ob, va, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('lkcd,ck,dl,ijab->ijab', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_abab +=  0.50 * einsum('klcd,ck,dl,ijab->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_abab +=  0.50 * einsum('lkdc,ck,dl,ijab->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('lkcd,ck,dl,ijab->ijab', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('ljcd,cl,dk,ikab->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('jlcd,cl,dk,ikab->ijab', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ilcd,cl,dk,kjab->ijab', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('ildc,cl,dk,kjab->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('lkda,cl,dk,ijcb->ijab', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 2), (0, 2), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('lkad,cl,dk,ijcb->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 2), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('kldb,cl,dk,ijac->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('lkdb,cl,dk,ijac->ijab', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.50 * einsum('ijcd,cl,dk,lkab->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.50 * einsum('ijdc,cl,dk,klab->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ljad,cl,dk,ikcb->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ljdb,cl,dk,ikca->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('jldb,cl,dk,ikac->ijab', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ilda,cl,dk,kjcb->ijab', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ilad,cl,dk,jkcb->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_bb, l2_bbbb, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ildb,cl,dk,kjac->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (1, 3), (1, 2), (0, 1)])
    lambda_doubles_res_abab +=  0.50 * einsum('lkab,cl,dk,ijcd->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.50 * einsum('klab,cl,dk,ijdc->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    return lambda_doubles_res_abab


def get_lambda_doubles_res_abba(
    uhf_scf_data: Intermediates,
    uhf_ccsd_data: UHF_CCSD_Data,
) -> NDArray:
    f_aa = uhf_scf_data.f_aa
    f_bb = uhf_scf_data.f_bb
    g_aaaa = uhf_scf_data.g_aaaa
    g_abab = uhf_scf_data.g_abab
    g_bbbb = uhf_scf_data.g_bbbb
    va = uhf_scf_data.va
    vb = uhf_scf_data.vb
    oa = uhf_scf_data.oa
    ob = uhf_scf_data.ob
    t1_aa = uhf_ccsd_data.t1_aa
    t1_bb = uhf_ccsd_data.t1_bb
    t2_aaaa = uhf_ccsd_data.t2_aaaa
    t2_abab = uhf_ccsd_data.t2_abab
    t2_bbbb = uhf_ccsd_data.t2_bbbb
    if uhf_ccsd_data.lmbda is None:
        raise RuntimeError("Lambda amplitues missing in UHF_CCSD_Data")
    l1_aa = uhf_ccsd_data.lmbda.l1_aa
    l1_bb = uhf_ccsd_data.lmbda.l1_bb
    l2_aaaa = uhf_ccsd_data.lmbda.l2_aaaa
    l2_abab = uhf_ccsd_data.lmbda.l2_abab
    l2_bbbb = uhf_ccsd_data.lmbda.l2_bbbb
    
    lambda_doubles_res_abba = -1.00 * einsum('ja,ib->ijab', f_bb[ob, vb], l1_aa)
    lambda_doubles_res_abba += -1.00 * einsum('ib,ja->ijab', f_aa[oa, va], l1_bb)
    lambda_doubles_res_abba += -1.00 * einsum('kk,ijba->ijab', f_aa[oa, oa], l2_abab)
    lambda_doubles_res_abba += -1.00 * einsum('kk,ijba->ijab', f_bb[ob, ob], l2_abab)
    lambda_doubles_res_abba +=  1.00 * einsum('jk,ikba->ijab', f_bb[ob, ob], l2_abab)
    lambda_doubles_res_abba +=  1.00 * einsum('ik,kjba->ijab', f_aa[oa, oa], l2_abab)
    lambda_doubles_res_abba += -1.00 * einsum('ca,ijbc->ijab', f_bb[vb, vb], l2_abab)
    lambda_doubles_res_abba += -1.00 * einsum('cb,ijca->ijab', f_aa[va, va], l2_abab)
    lambda_doubles_res_abba += -1.00 * einsum('kc,ck,ijba->ijab', f_aa[oa, va], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('kc,ck,ijba->ijab', f_bb[ob, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('jc,ck,ikba->ijab', f_bb[ob, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('ic,ck,kjba->ijab', f_aa[oa, va], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('ka,ck,ijbc->ijab', f_bb[ob, vb], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('kb,ck,ijca->ijab', f_aa[oa, va], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('lklk,ijba->ijab', g_aaaa[oa, oa, oa, oa], l2_abab)
    lambda_doubles_res_abba +=  0.50 * einsum('lklk,ijba->ijab', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_abba +=  0.50 * einsum('klkl,ijba->ijab', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_abba +=  0.50 * einsum('lklk,ijba->ijab', g_bbbb[ob, ob, ob, ob], l2_abab)
    lambda_doubles_res_abba += -1.00 * einsum('ijba->ijab', g_abab[oa, ob, va, vb])
    lambda_doubles_res_abba +=  1.00 * einsum('ijka,kb->ijab', g_abab[oa, ob, oa, vb], l1_aa)
    lambda_doubles_res_abba +=  1.00 * einsum('ijbk,ka->ijab', g_abab[oa, ob, va, ob], l1_bb)
    lambda_doubles_res_abba += -1.00 * einsum('cjba,ic->ijab', g_abab[va, ob, va, vb], l1_aa)
    lambda_doubles_res_abba += -1.00 * einsum('icba,jc->ijab', g_abab[oa, vb, va, vb], l1_bb)
    lambda_doubles_res_abba += -0.50 * einsum('ijkl,klba->ijab', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_abba += -0.50 * einsum('ijlk,lkba->ijab', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_abba +=  1.00 * einsum('cjka,ikcb->ijab', g_abab[va, ob, oa, vb], l2_aaaa)
    lambda_doubles_res_abba += -1.00 * einsum('jcak,ikbc->ijab', g_bbbb[ob, vb, vb, ob], l2_abab)
    lambda_doubles_res_abba +=  1.00 * einsum('cjbk,ikca->ijab', g_abab[va, ob, va, ob], l2_abab)
    lambda_doubles_res_abba +=  1.00 * einsum('icka,kjbc->ijab', g_abab[oa, vb, oa, vb], l2_abab)
    lambda_doubles_res_abba += -1.00 * einsum('icbk,kjca->ijab', g_aaaa[oa, va, va, oa], l2_abab)
    lambda_doubles_res_abba +=  1.00 * einsum('icbk,jkca->ijab', g_abab[oa, vb, va, ob], l2_bbbb)
    lambda_doubles_res_abba += -0.50 * einsum('dcba,ijdc->ijab', g_abab[va, vb, va, vb], l2_abab)
    lambda_doubles_res_abba += -0.50 * einsum('cdba,ijcd->ijab', g_abab[va, vb, va, vb], l2_abab)
    lambda_doubles_res_abba += -1.00 * einsum('kjca,ck,ib->ijab', g_abab[oa, ob, va, vb], t1_aa, l1_aa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('jkca,ck,ib->ijab', g_bbbb[ob, ob, vb, vb], t1_bb, l1_aa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('ikcb,ck,ja->ijab', g_aaaa[oa, oa, va, va], t1_aa, l1_bb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('ikbc,ck,ja->ijab', g_abab[oa, ob, va, vb], t1_bb, l1_bb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('ijca,ck,kb->ijab', g_abab[oa, ob, va, vb], t1_aa, l1_aa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('ijbc,ck,ka->ijab', g_abab[oa, ob, va, vb], t1_bb, l1_bb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('kjba,ck,ic->ijab', g_abab[oa, ob, va, vb], t1_aa, l1_aa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('ikba,ck,jc->ijab', g_abab[oa, ob, va, vb], t1_bb, l1_bb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('ljck,cl,ikba->ijab', g_abab[oa, ob, va, ob], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('jlck,cl,ikba->ijab', g_bbbb[ob, ob, vb, ob], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('ilck,cl,kjba->ijab', g_aaaa[oa, oa, va, oa], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('ilkc,cl,kjba->ijab', g_abab[oa, ob, oa, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('ijcl,ck,klba->ijab', g_abab[oa, ob, va, ob], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('ijlc,ck,lkba->ijab', g_abab[oa, ob, oa, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('ljka,cl,ikcb->ijab', g_abab[oa, ob, oa, vb], t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('jlak,cl,ikbc->ijab', g_bbbb[ob, ob, vb, ob], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('ljbk,cl,ikca->ijab', g_abab[oa, ob, va, ob], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('ilka,cl,kjbc->ijab', g_abab[oa, ob, oa, vb], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('ilbk,cl,kjca->ijab', g_aaaa[oa, oa, va, oa], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('ilbk,cl,jkca->ijab', g_abab[oa, ob, va, ob], t1_bb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('kcda,dk,ijbc->ijab', g_abab[oa, vb, va, vb], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('kcda,dk,ijbc->ijab', g_bbbb[ob, vb, vb, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('kcdb,dk,ijca->ijab', g_aaaa[oa, va, va, va], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('ckbd,dk,ijca->ijab', g_abab[va, ob, va, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('cjda,dk,ikcb->ijab', g_abab[va, ob, va, vb], t1_aa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('jcda,dk,ikbc->ijab', g_bbbb[ob, vb, vb, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('cjbd,dk,ikca->ijab', g_abab[va, ob, va, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('icda,dk,kjbc->ijab', g_abab[oa, vb, va, vb], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('icdb,dk,kjca->ijab', g_aaaa[oa, va, va, va], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('icbd,dk,jkca->ijab', g_abab[oa, vb, va, vb], t1_bb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('kdba,ck,ijcd->ijab', g_abab[oa, vb, va, vb], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('dkba,ck,ijdc->ijab', g_abab[va, ob, va, vb], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba += -0.250 * einsum('lkcd,cdlk,ijba->ijab', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.250 * einsum('lkcd,cdlk,ijba->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.250 * einsum('klcd,cdkl,ijba->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.250 * einsum('lkdc,dclk,ijba->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.250 * einsum('kldc,dckl,ijba->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.250 * einsum('lkcd,cdlk,ijba->ijab', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('ljcd,cdlk,ikba->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('ljdc,dclk,ikba->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('jlcd,cdkl,ikba->ijab', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('ilcd,cdkl,kjba->ijab', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('ilcd,cdkl,kjba->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('ildc,dckl,kjba->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.250 * einsum('ijcd,cdkl,klba->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.250 * einsum('ijcd,cdlk,lkba->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.250 * einsum('ijdc,dckl,klba->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.250 * einsum('ijdc,dclk,lkba->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('lkda,dclk,ijbc->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('klda,dckl,ijbc->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('lkda,dclk,ijbc->ijab', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('lkdb,dclk,ijca->ijab', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('lkbd,cdlk,ijca->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('klbd,cdkl,ijca->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('ljda,dckl,ikcb->ijab', g_abab[oa, ob, va, vb], t2_aaaa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('ljda,dclk,ikbc->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('jlda,cdkl,ikcb->ijab', g_bbbb[ob, ob, vb, vb], t2_abab, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('jlda,dckl,ikbc->ijab', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('ljbd,cdlk,ikca->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('ilda,dckl,kjbc->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('ildb,dckl,kjca->ijab', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('ildb,dclk,jkca->ijab', g_aaaa[oa, oa, va, va], t2_abab, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('ilbd,cdkl,kjca->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('ilbd,dckl,jkca->ijab', g_abab[oa, ob, va, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.50 * einsum('ijda,dckl,klcb->ijab', g_abab[oa, ob, va, vb], t2_aaaa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('ijda,dckl,klbc->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('ijda,dclk,lkbc->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('ijbd,cdkl,klca->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('ijbd,cdlk,lkca->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba += -0.50 * einsum('ijbd,dckl,klca->ijab', g_abab[oa, ob, va, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba += -0.250 * einsum('lkba,dclk,ijdc->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.250 * einsum('klba,dckl,ijdc->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.250 * einsum('lkba,cdlk,ijcd->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.250 * einsum('klba,cdkl,ijcd->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.50 * einsum('ljba,dckl,ikdc->ijab', g_abab[oa, ob, va, vb], t2_aaaa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('ljba,dclk,ikdc->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('ljba,cdlk,ikcd->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('ilba,dckl,kjdc->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('ilba,cdkl,kjcd->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba += -0.50 * einsum('ilba,dckl,jkdc->ijab', g_abab[oa, ob, va, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('lkcd,ck,dl,ijba->ijab', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_abba += -0.50 * einsum('klcd,ck,dl,ijba->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_abba += -0.50 * einsum('lkdc,ck,dl,ijba->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('lkcd,ck,dl,ijba->ijab', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('ljcd,cl,dk,ikba->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('jlcd,cl,dk,ikba->ijab', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('ilcd,cl,dk,kjba->ijab', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('ildc,cl,dk,kjba->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('klda,cl,dk,ijbc->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('lkda,cl,dk,ijbc->ijab', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('lkdb,cl,dk,ijca->ijab', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 2), (0, 2), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('lkbd,cl,dk,ijca->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 2), (0, 1)])
    lambda_doubles_res_abba += -0.50 * einsum('ijcd,cl,dk,lkba->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.50 * einsum('ijdc,cl,dk,klba->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('ljda,cl,dk,ikcb->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('jlda,cl,dk,ikbc->ijab', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('ljbd,cl,dk,ikca->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('ilda,cl,dk,kjbc->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (1, 3), (1, 2), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('ildb,cl,dk,kjca->ijab', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('ilbd,cl,dk,jkca->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_bb, l2_bbbb, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.50 * einsum('lkba,cl,dk,ijcd->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.50 * einsum('klba,cl,dk,ijdc->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    return lambda_doubles_res_abba


def get_lambda_doubles_res_baab(
    uhf_scf_data: Intermediates,
    uhf_ccsd_data: UHF_CCSD_Data,
) -> NDArray:
    f_aa = uhf_scf_data.f_aa
    f_bb = uhf_scf_data.f_bb
    g_aaaa = uhf_scf_data.g_aaaa
    g_abab = uhf_scf_data.g_abab
    g_bbbb = uhf_scf_data.g_bbbb
    va = uhf_scf_data.va
    vb = uhf_scf_data.vb
    oa = uhf_scf_data.oa
    ob = uhf_scf_data.ob
    t1_aa = uhf_ccsd_data.t1_aa
    t1_bb = uhf_ccsd_data.t1_bb
    t2_aaaa = uhf_ccsd_data.t2_aaaa
    t2_abab = uhf_ccsd_data.t2_abab
    t2_bbbb = uhf_ccsd_data.t2_bbbb
    if uhf_ccsd_data.lmbda is None:
        raise RuntimeError("Lambda amplitues missing in UHF_CCSD_Data")
    l1_aa = uhf_ccsd_data.lmbda.l1_aa
    l1_bb = uhf_ccsd_data.lmbda.l1_bb
    l2_aaaa = uhf_ccsd_data.lmbda.l2_aaaa
    l2_abab = uhf_ccsd_data.lmbda.l2_abab
    l2_bbbb = uhf_ccsd_data.lmbda.l2_bbbb
    
    lambda_doubles_res_baab = -1.00 * einsum('ja,ib->ijab', f_aa[oa, va], l1_bb)
    lambda_doubles_res_baab += -1.00 * einsum('ib,ja->ijab', f_bb[ob, vb], l1_aa)
    lambda_doubles_res_baab += -1.00 * einsum('kk,jiab->ijab', f_aa[oa, oa], l2_abab)
    lambda_doubles_res_baab += -1.00 * einsum('kk,jiab->ijab', f_bb[ob, ob], l2_abab)
    lambda_doubles_res_baab +=  1.00 * einsum('jk,kiab->ijab', f_aa[oa, oa], l2_abab)
    lambda_doubles_res_baab +=  1.00 * einsum('ik,jkab->ijab', f_bb[ob, ob], l2_abab)
    lambda_doubles_res_baab += -1.00 * einsum('ca,jicb->ijab', f_aa[va, va], l2_abab)
    lambda_doubles_res_baab += -1.00 * einsum('cb,jiac->ijab', f_bb[vb, vb], l2_abab)
    lambda_doubles_res_baab += -1.00 * einsum('kc,ck,jiab->ijab', f_aa[oa, va], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('kc,ck,jiab->ijab', f_bb[ob, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('jc,ck,kiab->ijab', f_aa[oa, va], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('ic,ck,jkab->ijab', f_bb[ob, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('ka,ck,jicb->ijab', f_aa[oa, va], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('kb,ck,jiac->ijab', f_bb[ob, vb], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('lklk,jiab->ijab', g_aaaa[oa, oa, oa, oa], l2_abab)
    lambda_doubles_res_baab +=  0.50 * einsum('lklk,jiab->ijab', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_baab +=  0.50 * einsum('klkl,jiab->ijab', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_baab +=  0.50 * einsum('lklk,jiab->ijab', g_bbbb[ob, ob, ob, ob], l2_abab)
    lambda_doubles_res_baab += -1.00 * einsum('jiab->ijab', g_abab[oa, ob, va, vb])
    lambda_doubles_res_baab +=  1.00 * einsum('jiak,kb->ijab', g_abab[oa, ob, va, ob], l1_bb)
    lambda_doubles_res_baab +=  1.00 * einsum('jikb,ka->ijab', g_abab[oa, ob, oa, vb], l1_aa)
    lambda_doubles_res_baab += -1.00 * einsum('jcab,ic->ijab', g_abab[oa, vb, va, vb], l1_bb)
    lambda_doubles_res_baab += -1.00 * einsum('ciab,jc->ijab', g_abab[va, ob, va, vb], l1_aa)
    lambda_doubles_res_baab += -0.50 * einsum('jikl,klab->ijab', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_baab += -0.50 * einsum('jilk,lkab->ijab', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_baab += -1.00 * einsum('jcak,kicb->ijab', g_aaaa[oa, va, va, oa], l2_abab)
    lambda_doubles_res_baab +=  1.00 * einsum('jcak,ikcb->ijab', g_abab[oa, vb, va, ob], l2_bbbb)
    lambda_doubles_res_baab +=  1.00 * einsum('jckb,kiac->ijab', g_abab[oa, vb, oa, vb], l2_abab)
    lambda_doubles_res_baab +=  1.00 * einsum('ciak,jkcb->ijab', g_abab[va, ob, va, ob], l2_abab)
    lambda_doubles_res_baab +=  1.00 * einsum('cikb,jkca->ijab', g_abab[va, ob, oa, vb], l2_aaaa)
    lambda_doubles_res_baab += -1.00 * einsum('icbk,jkac->ijab', g_bbbb[ob, vb, vb, ob], l2_abab)
    lambda_doubles_res_baab += -0.50 * einsum('dcab,jidc->ijab', g_abab[va, vb, va, vb], l2_abab)
    lambda_doubles_res_baab += -0.50 * einsum('cdab,jicd->ijab', g_abab[va, vb, va, vb], l2_abab)
    lambda_doubles_res_baab +=  1.00 * einsum('jkca,ck,ib->ijab', g_aaaa[oa, oa, va, va], t1_aa, l1_bb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('jkac,ck,ib->ijab', g_abab[oa, ob, va, vb], t1_bb, l1_bb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('kicb,ck,ja->ijab', g_abab[oa, ob, va, vb], t1_aa, l1_aa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('ikcb,ck,ja->ijab', g_bbbb[ob, ob, vb, vb], t1_bb, l1_aa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('jiac,ck,kb->ijab', g_abab[oa, ob, va, vb], t1_bb, l1_bb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('jicb,ck,ka->ijab', g_abab[oa, ob, va, vb], t1_aa, l1_aa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('jkab,ck,ic->ijab', g_abab[oa, ob, va, vb], t1_bb, l1_bb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('kiab,ck,jc->ijab', g_abab[oa, ob, va, vb], t1_aa, l1_aa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('jlck,cl,kiab->ijab', g_aaaa[oa, oa, va, oa], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('jlkc,cl,kiab->ijab', g_abab[oa, ob, oa, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('lick,cl,jkab->ijab', g_abab[oa, ob, va, ob], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('ilck,cl,jkab->ijab', g_bbbb[ob, ob, vb, ob], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('jicl,ck,klab->ijab', g_abab[oa, ob, va, ob], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('jilc,ck,lkab->ijab', g_abab[oa, ob, oa, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('jlak,cl,kicb->ijab', g_aaaa[oa, oa, va, oa], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('jlak,cl,ikcb->ijab', g_abab[oa, ob, va, ob], t1_bb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('jlkb,cl,kiac->ijab', g_abab[oa, ob, oa, vb], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('liak,cl,jkcb->ijab', g_abab[oa, ob, va, ob], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('likb,cl,jkca->ijab', g_abab[oa, ob, oa, vb], t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('ilbk,cl,jkac->ijab', g_bbbb[ob, ob, vb, ob], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('kcda,dk,jicb->ijab', g_aaaa[oa, va, va, va], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('ckad,dk,jicb->ijab', g_abab[va, ob, va, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('kcdb,dk,jiac->ijab', g_abab[oa, vb, va, vb], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('kcdb,dk,jiac->ijab', g_bbbb[ob, vb, vb, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('jcda,dk,kicb->ijab', g_aaaa[oa, va, va, va], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('jcad,dk,ikcb->ijab', g_abab[oa, vb, va, vb], t1_bb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('jcdb,dk,kiac->ijab', g_abab[oa, vb, va, vb], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('ciad,dk,jkcb->ijab', g_abab[va, ob, va, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('cidb,dk,jkca->ijab', g_abab[va, ob, va, vb], t1_aa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('icdb,dk,jkac->ijab', g_bbbb[ob, vb, vb, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('kdab,ck,jicd->ijab', g_abab[oa, vb, va, vb], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('dkab,ck,jidc->ijab', g_abab[va, ob, va, vb], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab += -0.250 * einsum('lkcd,cdlk,jiab->ijab', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.250 * einsum('lkcd,cdlk,jiab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.250 * einsum('klcd,cdkl,jiab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.250 * einsum('lkdc,dclk,jiab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.250 * einsum('kldc,dckl,jiab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.250 * einsum('lkcd,cdlk,jiab->ijab', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('jlcd,cdkl,kiab->ijab', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('jlcd,cdkl,kiab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('jldc,dckl,kiab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('licd,cdlk,jkab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('lidc,dclk,jkab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('ilcd,cdkl,jkab->ijab', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.250 * einsum('jicd,cdkl,klab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.250 * einsum('jicd,cdlk,lkab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.250 * einsum('jidc,dckl,klab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.250 * einsum('jidc,dclk,lkab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('lkda,dclk,jicb->ijab', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('lkad,cdlk,jicb->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('klad,cdkl,jicb->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('lkdb,dclk,jiac->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('kldb,dckl,jiac->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('lkdb,dclk,jiac->ijab', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('jlda,dckl,kicb->ijab', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('jlda,dclk,ikcb->ijab', g_aaaa[oa, oa, va, va], t2_abab, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('jlad,cdkl,kicb->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('jlad,dckl,ikcb->ijab', g_abab[oa, ob, va, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('jldb,dckl,kiac->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('liad,cdlk,jkcb->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('lidb,dckl,jkca->ijab', g_abab[oa, ob, va, vb], t2_aaaa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('lidb,dclk,jkac->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('ildb,cdkl,jkca->ijab', g_bbbb[ob, ob, vb, vb], t2_abab, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('ildb,dckl,jkac->ijab', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('jiad,cdkl,klcb->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('jiad,cdlk,lkcb->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab += -0.50 * einsum('jiad,dckl,klcb->ijab', g_abab[oa, ob, va, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab += -0.50 * einsum('jidb,dckl,klca->ijab', g_abab[oa, ob, va, vb], t2_aaaa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('jidb,dckl,klac->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('jidb,dclk,lkac->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab += -0.250 * einsum('lkab,dclk,jidc->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.250 * einsum('klab,dckl,jidc->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.250 * einsum('lkab,cdlk,jicd->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.250 * einsum('klab,cdkl,jicd->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('jlab,dckl,kidc->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('jlab,cdkl,kicd->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab += -0.50 * einsum('jlab,dckl,ikdc->ijab', g_abab[oa, ob, va, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab += -0.50 * einsum('liab,dckl,jkdc->ijab', g_abab[oa, ob, va, vb], t2_aaaa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('liab,dclk,jkdc->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('liab,cdlk,jkcd->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('lkcd,ck,dl,jiab->ijab', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_baab += -0.50 * einsum('klcd,ck,dl,jiab->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_baab += -0.50 * einsum('lkdc,ck,dl,jiab->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('lkcd,ck,dl,jiab->ijab', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('jlcd,cl,dk,kiab->ijab', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('jldc,cl,dk,kiab->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('licd,cl,dk,jkab->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('ilcd,cl,dk,jkab->ijab', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('lkda,cl,dk,jicb->ijab', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 2), (0, 2), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('lkad,cl,dk,jicb->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 2), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('kldb,cl,dk,jiac->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('lkdb,cl,dk,jiac->ijab', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.50 * einsum('jicd,cl,dk,lkab->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.50 * einsum('jidc,cl,dk,klab->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('jlda,cl,dk,kicb->ijab', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('jlad,cl,dk,ikcb->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_bb, l2_bbbb, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('jldb,cl,dk,kiac->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (1, 3), (1, 2), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('liad,cl,dk,jkcb->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('lidb,cl,dk,jkca->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('ildb,cl,dk,jkac->ijab', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.50 * einsum('lkab,cl,dk,jicd->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.50 * einsum('klab,cl,dk,jidc->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    return lambda_doubles_res_baab


def get_lambda_doubles_res_baba(
    uhf_scf_data: Intermediates,
    uhf_ccsd_data: UHF_CCSD_Data,
) -> NDArray:
    f_aa = uhf_scf_data.f_aa
    f_bb = uhf_scf_data.f_bb
    g_aaaa = uhf_scf_data.g_aaaa
    g_abab = uhf_scf_data.g_abab
    g_bbbb = uhf_scf_data.g_bbbb
    va = uhf_scf_data.va
    vb = uhf_scf_data.vb
    oa = uhf_scf_data.oa
    ob = uhf_scf_data.ob
    t1_aa = uhf_ccsd_data.t1_aa
    t1_bb = uhf_ccsd_data.t1_bb
    t2_aaaa = uhf_ccsd_data.t2_aaaa
    t2_abab = uhf_ccsd_data.t2_abab
    t2_bbbb = uhf_ccsd_data.t2_bbbb
    if uhf_ccsd_data.lmbda is None:
        raise RuntimeError("Lambda amplitues missing in UHF_CCSD_Data")
    l1_aa = uhf_ccsd_data.lmbda.l1_aa
    l1_bb = uhf_ccsd_data.lmbda.l1_bb
    l2_aaaa = uhf_ccsd_data.lmbda.l2_aaaa
    l2_abab = uhf_ccsd_data.lmbda.l2_abab
    l2_bbbb = uhf_ccsd_data.lmbda.l2_bbbb
    
    lambda_doubles_res_baba =  1.00 * einsum('jb,ia->ijab', f_aa[oa, va], l1_bb)
    lambda_doubles_res_baba +=  1.00 * einsum('ia,jb->ijab', f_bb[ob, vb], l1_aa)
    lambda_doubles_res_baba +=  1.00 * einsum('kk,jiba->ijab', f_aa[oa, oa], l2_abab)
    lambda_doubles_res_baba +=  1.00 * einsum('kk,jiba->ijab', f_bb[ob, ob], l2_abab)
    lambda_doubles_res_baba += -1.00 * einsum('jk,kiba->ijab', f_aa[oa, oa], l2_abab)
    lambda_doubles_res_baba += -1.00 * einsum('ik,jkba->ijab', f_bb[ob, ob], l2_abab)
    lambda_doubles_res_baba +=  1.00 * einsum('ca,jibc->ijab', f_bb[vb, vb], l2_abab)
    lambda_doubles_res_baba +=  1.00 * einsum('cb,jica->ijab', f_aa[va, va], l2_abab)
    lambda_doubles_res_baba +=  1.00 * einsum('kc,ck,jiba->ijab', f_aa[oa, va], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('kc,ck,jiba->ijab', f_bb[ob, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('jc,ck,kiba->ijab', f_aa[oa, va], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('ic,ck,jkba->ijab', f_bb[ob, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('ka,ck,jibc->ijab', f_bb[ob, vb], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('kb,ck,jica->ijab', f_aa[oa, va], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('lklk,jiba->ijab', g_aaaa[oa, oa, oa, oa], l2_abab)
    lambda_doubles_res_baba += -0.50 * einsum('lklk,jiba->ijab', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_baba += -0.50 * einsum('klkl,jiba->ijab', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_baba += -0.50 * einsum('lklk,jiba->ijab', g_bbbb[ob, ob, ob, ob], l2_abab)
    lambda_doubles_res_baba +=  1.00 * einsum('jiba->ijab', g_abab[oa, ob, va, vb])
    lambda_doubles_res_baba += -1.00 * einsum('jika,kb->ijab', g_abab[oa, ob, oa, vb], l1_aa)
    lambda_doubles_res_baba += -1.00 * einsum('jibk,ka->ijab', g_abab[oa, ob, va, ob], l1_bb)
    lambda_doubles_res_baba +=  1.00 * einsum('jcba,ic->ijab', g_abab[oa, vb, va, vb], l1_bb)
    lambda_doubles_res_baba +=  1.00 * einsum('ciba,jc->ijab', g_abab[va, ob, va, vb], l1_aa)
    lambda_doubles_res_baba +=  0.50 * einsum('jikl,klba->ijab', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_baba +=  0.50 * einsum('jilk,lkba->ijab', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_baba += -1.00 * einsum('jcka,kibc->ijab', g_abab[oa, vb, oa, vb], l2_abab)
    lambda_doubles_res_baba +=  1.00 * einsum('jcbk,kica->ijab', g_aaaa[oa, va, va, oa], l2_abab)
    lambda_doubles_res_baba += -1.00 * einsum('jcbk,ikca->ijab', g_abab[oa, vb, va, ob], l2_bbbb)
    lambda_doubles_res_baba += -1.00 * einsum('cika,jkcb->ijab', g_abab[va, ob, oa, vb], l2_aaaa)
    lambda_doubles_res_baba +=  1.00 * einsum('icak,jkbc->ijab', g_bbbb[ob, vb, vb, ob], l2_abab)
    lambda_doubles_res_baba += -1.00 * einsum('cibk,jkca->ijab', g_abab[va, ob, va, ob], l2_abab)
    lambda_doubles_res_baba +=  0.50 * einsum('dcba,jidc->ijab', g_abab[va, vb, va, vb], l2_abab)
    lambda_doubles_res_baba +=  0.50 * einsum('cdba,jicd->ijab', g_abab[va, vb, va, vb], l2_abab)
    lambda_doubles_res_baba += -1.00 * einsum('jkcb,ck,ia->ijab', g_aaaa[oa, oa, va, va], t1_aa, l1_bb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('jkbc,ck,ia->ijab', g_abab[oa, ob, va, vb], t1_bb, l1_bb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('kica,ck,jb->ijab', g_abab[oa, ob, va, vb], t1_aa, l1_aa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('ikca,ck,jb->ijab', g_bbbb[ob, ob, vb, vb], t1_bb, l1_aa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('jica,ck,kb->ijab', g_abab[oa, ob, va, vb], t1_aa, l1_aa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('jibc,ck,ka->ijab', g_abab[oa, ob, va, vb], t1_bb, l1_bb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('jkba,ck,ic->ijab', g_abab[oa, ob, va, vb], t1_bb, l1_bb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('kiba,ck,jc->ijab', g_abab[oa, ob, va, vb], t1_aa, l1_aa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('jlck,cl,kiba->ijab', g_aaaa[oa, oa, va, oa], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('jlkc,cl,kiba->ijab', g_abab[oa, ob, oa, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('lick,cl,jkba->ijab', g_abab[oa, ob, va, ob], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('ilck,cl,jkba->ijab', g_bbbb[ob, ob, vb, ob], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('jicl,ck,klba->ijab', g_abab[oa, ob, va, ob], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('jilc,ck,lkba->ijab', g_abab[oa, ob, oa, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('jlka,cl,kibc->ijab', g_abab[oa, ob, oa, vb], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('jlbk,cl,kica->ijab', g_aaaa[oa, oa, va, oa], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('jlbk,cl,ikca->ijab', g_abab[oa, ob, va, ob], t1_bb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('lika,cl,jkcb->ijab', g_abab[oa, ob, oa, vb], t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('ilak,cl,jkbc->ijab', g_bbbb[ob, ob, vb, ob], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('libk,cl,jkca->ijab', g_abab[oa, ob, va, ob], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('kcda,dk,jibc->ijab', g_abab[oa, vb, va, vb], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('kcda,dk,jibc->ijab', g_bbbb[ob, vb, vb, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('kcdb,dk,jica->ijab', g_aaaa[oa, va, va, va], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('ckbd,dk,jica->ijab', g_abab[va, ob, va, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('jcda,dk,kibc->ijab', g_abab[oa, vb, va, vb], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('jcdb,dk,kica->ijab', g_aaaa[oa, va, va, va], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('jcbd,dk,ikca->ijab', g_abab[oa, vb, va, vb], t1_bb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('cida,dk,jkcb->ijab', g_abab[va, ob, va, vb], t1_aa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('icda,dk,jkbc->ijab', g_bbbb[ob, vb, vb, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('cibd,dk,jkca->ijab', g_abab[va, ob, va, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('kdba,ck,jicd->ijab', g_abab[oa, vb, va, vb], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('dkba,ck,jidc->ijab', g_abab[va, ob, va, vb], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba +=  0.250 * einsum('lkcd,cdlk,jiba->ijab', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  0.250 * einsum('lkcd,cdlk,jiba->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  0.250 * einsum('klcd,cdkl,jiba->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  0.250 * einsum('lkdc,dclk,jiba->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  0.250 * einsum('kldc,dckl,jiba->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  0.250 * einsum('lkcd,cdlk,jiba->ijab', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('jlcd,cdkl,kiba->ijab', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('jlcd,cdkl,kiba->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('jldc,dckl,kiba->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('licd,cdlk,jkba->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('lidc,dclk,jkba->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('ilcd,cdkl,jkba->ijab', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  0.250 * einsum('jicd,cdkl,klba->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  0.250 * einsum('jicd,cdlk,lkba->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  0.250 * einsum('jidc,dckl,klba->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  0.250 * einsum('jidc,dclk,lkba->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('lkda,dclk,jibc->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('klda,dckl,jibc->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('lkda,dclk,jibc->ijab', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('lkdb,dclk,jica->ijab', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('lkbd,cdlk,jica->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('klbd,cdkl,jica->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('jlda,dckl,kibc->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('jldb,dckl,kica->ijab', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('jldb,dclk,ikca->ijab', g_aaaa[oa, oa, va, va], t2_abab, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('jlbd,cdkl,kica->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('jlbd,dckl,ikca->ijab', g_abab[oa, ob, va, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('lida,dckl,jkcb->ijab', g_abab[oa, ob, va, vb], t2_aaaa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('lida,dclk,jkbc->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('ilda,cdkl,jkcb->ijab', g_bbbb[ob, ob, vb, vb], t2_abab, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('ilda,dckl,jkbc->ijab', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('libd,cdlk,jkca->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  0.50 * einsum('jida,dckl,klcb->ijab', g_abab[oa, ob, va, vb], t2_aaaa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('jida,dckl,klbc->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('jida,dclk,lkbc->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('jibd,cdkl,klca->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('jibd,cdlk,lkca->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba +=  0.50 * einsum('jibd,dckl,klca->ijab', g_abab[oa, ob, va, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba +=  0.250 * einsum('lkba,dclk,jidc->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  0.250 * einsum('klba,dckl,jidc->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  0.250 * einsum('lkba,cdlk,jicd->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  0.250 * einsum('klba,cdkl,jicd->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('jlba,dckl,kidc->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('jlba,cdkl,kicd->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba +=  0.50 * einsum('jlba,dckl,ikdc->ijab', g_abab[oa, ob, va, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba +=  0.50 * einsum('liba,dckl,jkdc->ijab', g_abab[oa, ob, va, vb], t2_aaaa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('liba,dclk,jkdc->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('liba,cdlk,jkcd->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('lkcd,ck,dl,jiba->ijab', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_baba +=  0.50 * einsum('klcd,ck,dl,jiba->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_baba +=  0.50 * einsum('lkdc,ck,dl,jiba->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('lkcd,ck,dl,jiba->ijab', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('jlcd,cl,dk,kiba->ijab', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('jldc,cl,dk,kiba->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('licd,cl,dk,jkba->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('ilcd,cl,dk,jkba->ijab', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('klda,cl,dk,jibc->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('lkda,cl,dk,jibc->ijab', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('lkdb,cl,dk,jica->ijab', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 2), (0, 2), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('lkbd,cl,dk,jica->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 2), (0, 1)])
    lambda_doubles_res_baba +=  0.50 * einsum('jicd,cl,dk,lkba->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  0.50 * einsum('jidc,cl,dk,klba->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('jlda,cl,dk,kibc->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (1, 3), (1, 2), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('jldb,cl,dk,kica->ijab', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('jlbd,cl,dk,ikca->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_bb, l2_bbbb, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('lida,cl,dk,jkcb->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('ilda,cl,dk,jkbc->ijab', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('libd,cl,dk,jkca->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_baba +=  0.50 * einsum('lkba,cl,dk,jicd->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  0.50 * einsum('klba,cl,dk,jidc->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    return lambda_doubles_res_baba


def get_lambda_doubles_res_bbbb(
    uhf_scf_data: Intermediates,
    uhf_ccsd_data: UHF_CCSD_Data,
) -> NDArray:
    f_aa = uhf_scf_data.f_aa
    f_bb = uhf_scf_data.f_bb
    g_aaaa = uhf_scf_data.g_aaaa
    g_abab = uhf_scf_data.g_abab
    g_bbbb = uhf_scf_data.g_bbbb
    va = uhf_scf_data.va
    vb = uhf_scf_data.vb
    oa = uhf_scf_data.oa
    ob = uhf_scf_data.ob
    t1_aa = uhf_ccsd_data.t1_aa
    t1_bb = uhf_ccsd_data.t1_bb
    t2_aaaa = uhf_ccsd_data.t2_aaaa
    t2_abab = uhf_ccsd_data.t2_abab
    t2_bbbb = uhf_ccsd_data.t2_bbbb
    if uhf_ccsd_data.lmbda is None:
        raise RuntimeError("Lambda amplitues missing in UHF_CCSD_Data")
    l1_aa = uhf_ccsd_data.lmbda.l1_aa
    l1_bb = uhf_ccsd_data.lmbda.l1_bb
    l2_aaaa = uhf_ccsd_data.lmbda.l2_aaaa
    l2_abab = uhf_ccsd_data.lmbda.l2_abab
    l2_bbbb = uhf_ccsd_data.lmbda.l2_bbbb
    
    contracted_intermediate = -1.00 * einsum('ja,ib->ijab', f_bb[ob, vb], l1_bb)
    lambda_doubles_res_bbbb =  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate)  + -1.00000 * einsum('ijab->ijba', contracted_intermediate)  +  1.00000 * einsum('ijab->jiba', contracted_intermediate) 
    lambda_doubles_res_bbbb +=  1.00 * einsum('kk,ijab->ijab', f_aa[oa, oa], l2_bbbb)
    lambda_doubles_res_bbbb +=  1.00 * einsum('kk,ijab->ijab', f_bb[ob, ob], l2_bbbb)
    contracted_intermediate = -1.00 * einsum('jk,ikab->ijab', f_bb[ob, ob], l2_bbbb)
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('ca,ijcb->ijab', f_bb[vb, vb], l2_bbbb)
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->ijba', contracted_intermediate) 
    lambda_doubles_res_bbbb +=  1.00 * einsum('kc,ck,ijab->ijab', f_aa[oa, va], t1_aa, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00 * einsum('kc,ck,ijab->ijab', f_bb[ob, vb], t1_bb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    contracted_intermediate = -1.00 * einsum('jc,ck,ikab->ijab', f_bb[ob, vb], t1_bb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('ka,ck,ijcb->ijab', f_bb[ob, vb], t1_bb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->ijba', contracted_intermediate) 
    lambda_doubles_res_bbbb += -0.50 * einsum('lklk,ijab->ijab', g_aaaa[oa, oa, oa, oa], l2_bbbb)
    lambda_doubles_res_bbbb += -0.50 * einsum('lklk,ijab->ijab', g_abab[oa, ob, oa, ob], l2_bbbb)
    lambda_doubles_res_bbbb += -0.50 * einsum('klkl,ijab->ijab', g_abab[oa, ob, oa, ob], l2_bbbb)
    lambda_doubles_res_bbbb += -0.50 * einsum('lklk,ijab->ijab', g_bbbb[ob, ob, ob, ob], l2_bbbb)
    lambda_doubles_res_bbbb +=  1.00 * einsum('ijab->ijab', g_bbbb[ob, ob, vb, vb])
    contracted_intermediate = -1.00 * einsum('ijak,kb->ijab', g_bbbb[ob, ob, vb, ob], l1_bb)
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->ijba', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('jcab,ic->ijab', g_bbbb[ob, vb, vb, vb], l1_bb)
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate) 
    lambda_doubles_res_bbbb +=  0.50 * einsum('ijkl,klab->ijab', g_bbbb[ob, ob, ob, ob], l2_bbbb)
    contracted_intermediate = -1.00 * einsum('cjka,kicb->ijab', g_abab[va, ob, oa, vb], l2_abab)
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate)  + -1.00000 * einsum('ijab->ijba', contracted_intermediate)  +  1.00000 * einsum('ijab->jiba', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jcak,ikcb->ijab', g_bbbb[ob, vb, vb, ob], l2_bbbb)
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate)  + -1.00000 * einsum('ijab->ijba', contracted_intermediate)  +  1.00000 * einsum('ijab->jiba', contracted_intermediate) 
    lambda_doubles_res_bbbb +=  0.50 * einsum('dcab,ijdc->ijab', g_bbbb[vb, vb, vb, vb], l2_bbbb)
    contracted_intermediate = -1.00 * einsum('kjca,ck,ib->ijab', g_abab[oa, ob, va, vb], t1_aa, l1_bb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate)  + -1.00000 * einsum('ijab->ijba', contracted_intermediate)  +  1.00000 * einsum('ijab->jiba', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jkca,ck,ib->ijab', g_bbbb[ob, ob, vb, vb], t1_bb, l1_bb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate)  + -1.00000 * einsum('ijab->ijba', contracted_intermediate)  +  1.00000 * einsum('ijab->jiba', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('ijca,ck,kb->ijab', g_bbbb[ob, ob, vb, vb], t1_bb, l1_bb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->ijba', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jkab,ck,ic->ijab', g_bbbb[ob, ob, vb, vb], t1_bb, l1_bb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('ljck,cl,ikab->ijab', g_abab[oa, ob, va, ob], t1_aa, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jlck,cl,ikab->ijab', g_bbbb[ob, ob, vb, ob], t1_bb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate) 
    lambda_doubles_res_bbbb +=  1.00 * einsum('ijcl,ck,klab->ijab', g_bbbb[ob, ob, vb, ob], t1_bb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    contracted_intermediate =  1.00 * einsum('ljka,cl,kicb->ijab', g_abab[oa, ob, oa, vb], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate)  + -1.00000 * einsum('ijab->ijba', contracted_intermediate)  +  1.00000 * einsum('ijab->jiba', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('jlak,cl,ikcb->ijab', g_bbbb[ob, ob, vb, ob], t1_bb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate)  + -1.00000 * einsum('ijab->ijba', contracted_intermediate)  +  1.00000 * einsum('ijab->jiba', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('kcda,dk,ijcb->ijab', g_abab[oa, vb, va, vb], t1_aa, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->ijba', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('kcda,dk,ijcb->ijab', g_bbbb[ob, vb, vb, vb], t1_bb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->ijba', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('cjda,dk,kicb->ijab', g_abab[va, ob, va, vb], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate)  + -1.00000 * einsum('ijab->ijba', contracted_intermediate)  +  1.00000 * einsum('ijab->jiba', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('jcda,dk,ikcb->ijab', g_bbbb[ob, vb, vb, vb], t1_bb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate)  + -1.00000 * einsum('ijab->ijba', contracted_intermediate)  +  1.00000 * einsum('ijab->jiba', contracted_intermediate) 
    lambda_doubles_res_bbbb +=  1.00 * einsum('kdab,ck,ijdc->ijab', g_bbbb[ob, vb, vb, vb], t1_bb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_bbbb +=  0.250 * einsum('lkcd,cdlk,ijab->ijab', g_aaaa[oa, oa, va, va], t2_aaaa, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  0.250 * einsum('lkcd,cdlk,ijab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  0.250 * einsum('klcd,cdkl,ijab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  0.250 * einsum('lkdc,dclk,ijab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  0.250 * einsum('kldc,dckl,ijab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  0.250 * einsum('lkcd,cdlk,ijab->ijab', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    contracted_intermediate = -0.50 * einsum('ljcd,cdlk,ikab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate) 
    contracted_intermediate = -0.50 * einsum('ljdc,dclk,ikab->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate) 
    contracted_intermediate = -0.50 * einsum('jlcd,cdkl,ikab->ijab', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate) 
    lambda_doubles_res_bbbb +=  0.250 * einsum('ijcd,cdkl,klab->ijab', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    contracted_intermediate = -0.50 * einsum('lkda,dclk,ijcb->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->ijba', contracted_intermediate) 
    contracted_intermediate = -0.50 * einsum('klda,dckl,ijcb->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->ijba', contracted_intermediate) 
    contracted_intermediate = -0.50 * einsum('lkda,dclk,ijcb->ijab', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->ijba', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('ljda,dckl,kicb->ijab', g_abab[oa, ob, va, vb], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate)  + -1.00000 * einsum('ijab->ijba', contracted_intermediate)  +  1.00000 * einsum('ijab->jiba', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('ljda,dclk,ikcb->ijab', g_abab[oa, ob, va, vb], t2_abab, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate)  + -1.00000 * einsum('ijab->ijba', contracted_intermediate)  +  1.00000 * einsum('ijab->jiba', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jlda,cdkl,kicb->ijab', g_bbbb[ob, ob, vb, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate)  + -1.00000 * einsum('ijab->ijba', contracted_intermediate)  +  1.00000 * einsum('ijab->jiba', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jlda,dckl,ikcb->ijab', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate)  + -1.00000 * einsum('ijab->ijba', contracted_intermediate)  +  1.00000 * einsum('ijab->jiba', contracted_intermediate) 
    contracted_intermediate =  0.50 * einsum('ijda,cdkl,klcb->ijab', g_bbbb[ob, ob, vb, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->ijba', contracted_intermediate) 
    contracted_intermediate =  0.50 * einsum('ijda,cdlk,lkcb->ijab', g_bbbb[ob, ob, vb, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->ijba', contracted_intermediate) 
    contracted_intermediate = -0.50 * einsum('ijda,dckl,klcb->ijab', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->ijba', contracted_intermediate) 
    lambda_doubles_res_bbbb +=  0.250 * einsum('lkab,dclk,ijdc->ijab', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    contracted_intermediate =  0.50 * einsum('jlab,dckl,kidc->ijab', g_bbbb[ob, ob, vb, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate) 
    contracted_intermediate =  0.50 * einsum('jlab,cdkl,kicd->ijab', g_bbbb[ob, ob, vb, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate) 
    contracted_intermediate = -0.50 * einsum('jlab,dckl,ikdc->ijab', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate) 
    lambda_doubles_res_bbbb += -0.50 * einsum('lkcd,ck,dl,ijab->ijab', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_bbbb +=  0.50 * einsum('klcd,ck,dl,ijab->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_bbbb +=  0.50 * einsum('lkdc,ck,dl,ijab->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_bbbb += -0.50 * einsum('lkcd,ck,dl,ijab->ijab', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    contracted_intermediate = -1.00 * einsum('ljcd,cl,dk,ikab->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jlcd,cl,dk,ikab->ijab', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('klda,cl,dk,ijcb->ijab', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_bbbb, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->ijba', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('lkda,cl,dk,ijcb->ijab', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_bbbb, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->ijba', contracted_intermediate) 
    lambda_doubles_res_bbbb += -0.50 * einsum('ijcd,cl,dk,klab->ijab', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    contracted_intermediate =  1.00 * einsum('ljda,cl,dk,kicb->ijab', g_abab[oa, ob, va, vb], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate)  + -1.00000 * einsum('ijab->ijba', contracted_intermediate)  +  1.00000 * einsum('ijab->jiba', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jlda,cl,dk,ikcb->ijab', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_bbbb, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('ijab->jiab', contracted_intermediate)  + -1.00000 * einsum('ijab->ijba', contracted_intermediate)  +  1.00000 * einsum('ijab->jiba', contracted_intermediate) 
    lambda_doubles_res_bbbb += -0.50 * einsum('lkab,cl,dk,ijdc->ijab', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_bbbb, optimize=['einsum_path', (1, 3), (1, 2), (0, 1)])
    return lambda_doubles_res_bbbb
