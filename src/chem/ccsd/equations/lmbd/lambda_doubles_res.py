from numpy import einsum
from numpy.typing import NDArray
from chem.hf.intermediates_builders import Intermediates
from chem.ccsd.uhf_ccsd import UHF_CCSD_Data


def get_lambda_doubles_res_aaaa(
    uhf_scf_data: Intermediates,
    uhf_ccsd_data: UHF_CCSD_Data,
) -> NDArray:
    f_aa = uhf_scf_data.f_aa
    f_bb = uhf_scf_data.f_bb
    g_aaaa = uhf_scf_data.g_aaaa
    g_abab = uhf_scf_data.g_abab
    g_bbbb = uhf_scf_data.g_bbbb
    va = uhf_scf_data.va
    vb = uhf_scf_data.vb
    oa = uhf_scf_data.oa
    ob = uhf_scf_data.ob
    t1_aa = uhf_ccsd_data.t1_aa
    t1_bb = uhf_ccsd_data.t1_bb
    t2_aaaa = uhf_ccsd_data.t2_aaaa
    t2_abab = uhf_ccsd_data.t2_abab
    t2_bbbb = uhf_ccsd_data.t2_bbbb
    if uhf_ccsd_data.lmbda is None:
        raise RuntimeError("Lambda amplitues missing in UHF_CCSD_Data")
    l1_aa = uhf_ccsd_data.lmbda.l1_aa
    l1_bb = uhf_ccsd_data.lmbda.l1_bb
    l2_aaaa = uhf_ccsd_data.lmbda.l2_aaaa
    l2_abab = uhf_ccsd_data.lmbda.l2_abab
    l2_bbbb = uhf_ccsd_data.lmbda.l2_bbbb
    
    contracted_intermediate = -1.00 * einsum('ja,ib->abji', f_aa[oa, va], l1_aa)
    lambda_doubles_res_aaaa =  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate)  + -1.00000 * einsum('abji->baji', contracted_intermediate)  +  1.00000 * einsum('abji->baij', contracted_intermediate) 
    lambda_doubles_res_aaaa +=  1.00 * einsum('kk,ijab->abji', f_aa[oa, oa], l2_aaaa)
    lambda_doubles_res_aaaa +=  1.00 * einsum('kk,ijab->abji', f_bb[ob, ob], l2_aaaa)
    contracted_intermediate = -1.00 * einsum('jk,ikab->abji', f_aa[oa, oa], l2_aaaa)
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('ca,ijcb->abji', f_aa[va, va], l2_aaaa)
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->baji', contracted_intermediate) 
    lambda_doubles_res_aaaa +=  1.00 * einsum('kc,ck,ijab->abji', f_aa[oa, va], t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00 * einsum('kc,ck,ijab->abji', f_bb[ob, vb], t1_bb, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    contracted_intermediate = -1.00 * einsum('jc,ck,ikab->abji', f_aa[oa, va], t1_aa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('ka,ck,ijcb->abji', f_aa[oa, va], t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->baji', contracted_intermediate) 
    lambda_doubles_res_aaaa += -0.50 * einsum('lklk,ijab->abji', g_aaaa[oa, oa, oa, oa], l2_aaaa)
    lambda_doubles_res_aaaa += -0.50 * einsum('lklk,ijab->abji', g_abab[oa, ob, oa, ob], l2_aaaa)
    lambda_doubles_res_aaaa += -0.50 * einsum('klkl,ijab->abji', g_abab[oa, ob, oa, ob], l2_aaaa)
    lambda_doubles_res_aaaa += -0.50 * einsum('lklk,ijab->abji', g_bbbb[ob, ob, ob, ob], l2_aaaa)
    lambda_doubles_res_aaaa +=  1.00 * einsum('ijab->abji', g_aaaa[oa, oa, va, va])
    contracted_intermediate = -1.00 * einsum('ijak,kb->abji', g_aaaa[oa, oa, va, oa], l1_aa)
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->baji', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('jcab,ic->abji', g_aaaa[oa, va, va, va], l1_aa)
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate) 
    lambda_doubles_res_aaaa +=  0.50 * einsum('ijkl,klab->abji', g_aaaa[oa, oa, oa, oa], l2_aaaa)
    contracted_intermediate =  1.00 * einsum('jcak,ikcb->abji', g_aaaa[oa, va, va, oa], l2_aaaa)
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate)  + -1.00000 * einsum('abji->baji', contracted_intermediate)  +  1.00000 * einsum('abji->baij', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('jcak,ikbc->abji', g_abab[oa, vb, va, ob], l2_abab)
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate)  + -1.00000 * einsum('abji->baji', contracted_intermediate)  +  1.00000 * einsum('abji->baij', contracted_intermediate) 
    lambda_doubles_res_aaaa +=  0.50 * einsum('dcab,ijdc->abji', g_aaaa[va, va, va, va], l2_aaaa)
    contracted_intermediate =  1.00 * einsum('jkca,ck,ib->abji', g_aaaa[oa, oa, va, va], t1_aa, l1_aa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate)  + -1.00000 * einsum('abji->baji', contracted_intermediate)  +  1.00000 * einsum('abji->baij', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('jkac,ck,ib->abji', g_abab[oa, ob, va, vb], t1_bb, l1_aa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate)  + -1.00000 * einsum('abji->baji', contracted_intermediate)  +  1.00000 * einsum('abji->baij', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('ijca,ck,kb->abji', g_aaaa[oa, oa, va, va], t1_aa, l1_aa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->baji', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jkab,ck,ic->abji', g_aaaa[oa, oa, va, va], t1_aa, l1_aa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jlck,cl,ikab->abji', g_aaaa[oa, oa, va, oa], t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('jlkc,cl,ikab->abji', g_abab[oa, ob, oa, vb], t1_bb, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate) 
    lambda_doubles_res_aaaa +=  1.00 * einsum('ijcl,ck,klab->abji', g_aaaa[oa, oa, va, oa], t1_aa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    contracted_intermediate = -1.00 * einsum('jlak,cl,ikcb->abji', g_aaaa[oa, oa, va, oa], t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate)  + -1.00000 * einsum('abji->baji', contracted_intermediate)  +  1.00000 * einsum('abji->baij', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jlak,cl,ikbc->abji', g_abab[oa, ob, va, ob], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate)  + -1.00000 * einsum('abji->baji', contracted_intermediate)  +  1.00000 * einsum('abji->baij', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('kcda,dk,ijcb->abji', g_aaaa[oa, va, va, va], t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->baji', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('ckad,dk,ijcb->abji', g_abab[va, ob, va, vb], t1_bb, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->baji', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('jcda,dk,ikcb->abji', g_aaaa[oa, va, va, va], t1_aa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate)  + -1.00000 * einsum('abji->baji', contracted_intermediate)  +  1.00000 * einsum('abji->baij', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('jcad,dk,ikbc->abji', g_abab[oa, vb, va, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate)  + -1.00000 * einsum('abji->baji', contracted_intermediate)  +  1.00000 * einsum('abji->baij', contracted_intermediate) 
    lambda_doubles_res_aaaa +=  1.00 * einsum('kdab,ck,ijdc->abji', g_aaaa[oa, va, va, va], t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  0.250 * einsum('lkcd,cdlk,ijab->abji', g_aaaa[oa, oa, va, va], t2_aaaa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  0.250 * einsum('lkcd,cdlk,ijab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  0.250 * einsum('klcd,cdkl,ijab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  0.250 * einsum('lkdc,dclk,ijab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  0.250 * einsum('kldc,dckl,ijab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  0.250 * einsum('lkcd,cdlk,ijab->abji', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    contracted_intermediate = -0.50 * einsum('jlcd,cdkl,ikab->abji', g_aaaa[oa, oa, va, va], t2_aaaa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate) 
    contracted_intermediate = -0.50 * einsum('jlcd,cdkl,ikab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate) 
    contracted_intermediate = -0.50 * einsum('jldc,dckl,ikab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate) 
    lambda_doubles_res_aaaa +=  0.250 * einsum('ijcd,cdkl,klab->abji', g_aaaa[oa, oa, va, va], t2_aaaa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    contracted_intermediate = -0.50 * einsum('lkda,dclk,ijcb->abji', g_aaaa[oa, oa, va, va], t2_aaaa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->baji', contracted_intermediate) 
    contracted_intermediate = -0.50 * einsum('lkad,cdlk,ijcb->abji', g_abab[oa, ob, va, vb], t2_abab, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->baji', contracted_intermediate) 
    contracted_intermediate = -0.50 * einsum('klad,cdkl,ijcb->abji', g_abab[oa, ob, va, vb], t2_abab, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->baji', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jlda,dckl,ikcb->abji', g_aaaa[oa, oa, va, va], t2_aaaa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate)  + -1.00000 * einsum('abji->baji', contracted_intermediate)  +  1.00000 * einsum('abji->baij', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jlda,dclk,ikbc->abji', g_aaaa[oa, oa, va, va], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate)  + -1.00000 * einsum('abji->baji', contracted_intermediate)  +  1.00000 * einsum('abji->baij', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jlad,cdkl,ikcb->abji', g_abab[oa, ob, va, vb], t2_abab, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate)  + -1.00000 * einsum('abji->baji', contracted_intermediate)  +  1.00000 * einsum('abji->baij', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jlad,dckl,ikbc->abji', g_abab[oa, ob, va, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate)  + -1.00000 * einsum('abji->baji', contracted_intermediate)  +  1.00000 * einsum('abji->baij', contracted_intermediate) 
    contracted_intermediate = -0.50 * einsum('ijda,dckl,klcb->abji', g_aaaa[oa, oa, va, va], t2_aaaa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->baji', contracted_intermediate) 
    contracted_intermediate =  0.50 * einsum('ijda,dckl,klbc->abji', g_aaaa[oa, oa, va, va], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->baji', contracted_intermediate) 
    contracted_intermediate =  0.50 * einsum('ijda,dclk,lkbc->abji', g_aaaa[oa, oa, va, va], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->baji', contracted_intermediate) 
    lambda_doubles_res_aaaa +=  0.250 * einsum('lkab,dclk,ijdc->abji', g_aaaa[oa, oa, va, va], t2_aaaa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    contracted_intermediate = -0.50 * einsum('jlab,dckl,ikdc->abji', g_aaaa[oa, oa, va, va], t2_aaaa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate) 
    contracted_intermediate =  0.50 * einsum('jlab,dclk,ikdc->abji', g_aaaa[oa, oa, va, va], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate) 
    contracted_intermediate =  0.50 * einsum('jlab,cdlk,ikcd->abji', g_aaaa[oa, oa, va, va], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate) 
    lambda_doubles_res_aaaa += -0.50 * einsum('lkcd,ck,dl,ijab->abji', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_aaaa +=  0.50 * einsum('klcd,ck,dl,ijab->abji', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_aaaa +=  0.50 * einsum('lkdc,ck,dl,ijab->abji', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_aaaa += -0.50 * einsum('lkcd,ck,dl,ijab->abji', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    contracted_intermediate =  1.00 * einsum('jlcd,cl,dk,ikab->abji', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('jldc,cl,dk,ikab->abji', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('lkda,cl,dk,ijcb->abji', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_aaaa, optimize=['einsum_path', (0, 2), (0, 2), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->baji', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('lkad,cl,dk,ijcb->abji', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_aaaa, optimize=['einsum_path', (0, 2), (0, 2), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->baji', contracted_intermediate) 
    lambda_doubles_res_aaaa += -0.50 * einsum('ijcd,cl,dk,klab->abji', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_aaaa, optimize=['einsum_path', (1, 3), (1, 2), (0, 1)])
    contracted_intermediate =  1.00 * einsum('jlda,cl,dk,ikcb->abji', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate)  + -1.00000 * einsum('abji->baji', contracted_intermediate)  +  1.00000 * einsum('abji->baij', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jlad,cl,dk,ikbc->abji', g_abab[oa, ob, va, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_aaaa +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate)  + -1.00000 * einsum('abji->baji', contracted_intermediate)  +  1.00000 * einsum('abji->baij', contracted_intermediate) 
    lambda_doubles_res_aaaa += -0.50 * einsum('lkab,cl,dk,ijdc->abji', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    return lambda_doubles_res_aaaa


def get_lambda_doubles_res_abab(
    uhf_scf_data: Intermediates,
    uhf_ccsd_data: UHF_CCSD_Data,
) -> NDArray:
    f_aa = uhf_scf_data.f_aa
    f_bb = uhf_scf_data.f_bb
    g_aaaa = uhf_scf_data.g_aaaa
    g_abab = uhf_scf_data.g_abab
    g_bbbb = uhf_scf_data.g_bbbb
    va = uhf_scf_data.va
    vb = uhf_scf_data.vb
    oa = uhf_scf_data.oa
    ob = uhf_scf_data.ob
    t1_aa = uhf_ccsd_data.t1_aa
    t1_bb = uhf_ccsd_data.t1_bb
    t2_aaaa = uhf_ccsd_data.t2_aaaa
    t2_abab = uhf_ccsd_data.t2_abab
    t2_bbbb = uhf_ccsd_data.t2_bbbb
    if uhf_ccsd_data.lmbda is None:
        raise RuntimeError("Lambda amplitues missing in UHF_CCSD_Data")
    l1_aa = uhf_ccsd_data.lmbda.l1_aa
    l1_bb = uhf_ccsd_data.lmbda.l1_bb
    l2_aaaa = uhf_ccsd_data.lmbda.l2_aaaa
    l2_abab = uhf_ccsd_data.lmbda.l2_abab
    l2_bbbb = uhf_ccsd_data.lmbda.l2_bbbb
    
    lambda_doubles_res_abab =  1.00 * einsum('jb,ia->abji', f_bb[ob, vb], l1_aa)
    lambda_doubles_res_abab +=  1.00 * einsum('ia,jb->abji', f_aa[oa, va], l1_bb)
    lambda_doubles_res_abab +=  1.00 * einsum('kk,ijab->abji', f_aa[oa, oa], l2_abab)
    lambda_doubles_res_abab +=  1.00 * einsum('kk,ijab->abji', f_bb[ob, ob], l2_abab)
    lambda_doubles_res_abab += -1.00 * einsum('jk,ikab->abji', f_bb[ob, ob], l2_abab)
    lambda_doubles_res_abab += -1.00 * einsum('ik,kjab->abji', f_aa[oa, oa], l2_abab)
    lambda_doubles_res_abab +=  1.00 * einsum('ca,ijcb->abji', f_aa[va, va], l2_abab)
    lambda_doubles_res_abab +=  1.00 * einsum('cb,ijac->abji', f_bb[vb, vb], l2_abab)
    lambda_doubles_res_abab +=  1.00 * einsum('kc,ck,ijab->abji', f_aa[oa, va], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('kc,ck,ijab->abji', f_bb[ob, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('jc,ck,ikab->abji', f_bb[ob, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('ic,ck,kjab->abji', f_aa[oa, va], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('ka,ck,ijcb->abji', f_aa[oa, va], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('kb,ck,ijac->abji', f_bb[ob, vb], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('lklk,ijab->abji', g_aaaa[oa, oa, oa, oa], l2_abab)
    lambda_doubles_res_abab += -0.50 * einsum('lklk,ijab->abji', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_abab += -0.50 * einsum('klkl,ijab->abji', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_abab += -0.50 * einsum('lklk,ijab->abji', g_bbbb[ob, ob, ob, ob], l2_abab)
    lambda_doubles_res_abab +=  1.00 * einsum('ijab->abji', g_abab[oa, ob, va, vb])
    lambda_doubles_res_abab += -1.00 * einsum('ijak,kb->abji', g_abab[oa, ob, va, ob], l1_bb)
    lambda_doubles_res_abab += -1.00 * einsum('ijkb,ka->abji', g_abab[oa, ob, oa, vb], l1_aa)
    lambda_doubles_res_abab +=  1.00 * einsum('cjab,ic->abji', g_abab[va, ob, va, vb], l1_aa)
    lambda_doubles_res_abab +=  1.00 * einsum('icab,jc->abji', g_abab[oa, vb, va, vb], l1_bb)
    lambda_doubles_res_abab +=  0.50 * einsum('ijkl,klab->abji', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_abab +=  0.50 * einsum('ijlk,lkab->abji', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_abab += -1.00 * einsum('cjak,ikcb->abji', g_abab[va, ob, va, ob], l2_abab)
    lambda_doubles_res_abab += -1.00 * einsum('cjkb,ikca->abji', g_abab[va, ob, oa, vb], l2_aaaa)
    lambda_doubles_res_abab +=  1.00 * einsum('jcbk,ikac->abji', g_bbbb[ob, vb, vb, ob], l2_abab)
    lambda_doubles_res_abab +=  1.00 * einsum('icak,kjcb->abji', g_aaaa[oa, va, va, oa], l2_abab)
    lambda_doubles_res_abab += -1.00 * einsum('icak,jkcb->abji', g_abab[oa, vb, va, ob], l2_bbbb)
    lambda_doubles_res_abab += -1.00 * einsum('ickb,kjac->abji', g_abab[oa, vb, oa, vb], l2_abab)
    lambda_doubles_res_abab +=  0.50 * einsum('dcab,ijdc->abji', g_abab[va, vb, va, vb], l2_abab)
    lambda_doubles_res_abab +=  0.50 * einsum('cdab,ijcd->abji', g_abab[va, vb, va, vb], l2_abab)
    lambda_doubles_res_abab +=  1.00 * einsum('kjcb,ck,ia->abji', g_abab[oa, ob, va, vb], t1_aa, l1_aa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('jkcb,ck,ia->abji', g_bbbb[ob, ob, vb, vb], t1_bb, l1_aa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('ikca,ck,jb->abji', g_aaaa[oa, oa, va, va], t1_aa, l1_bb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ikac,ck,jb->abji', g_abab[oa, ob, va, vb], t1_bb, l1_bb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('ijac,ck,kb->abji', g_abab[oa, ob, va, vb], t1_bb, l1_bb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('ijcb,ck,ka->abji', g_abab[oa, ob, va, vb], t1_aa, l1_aa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('kjab,ck,ic->abji', g_abab[oa, ob, va, vb], t1_aa, l1_aa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('ikab,ck,jc->abji', g_abab[oa, ob, va, vb], t1_bb, l1_bb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('ljck,cl,ikab->abji', g_abab[oa, ob, va, ob], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('jlck,cl,ikab->abji', g_bbbb[ob, ob, vb, ob], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ilck,cl,kjab->abji', g_aaaa[oa, oa, va, oa], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('ilkc,cl,kjab->abji', g_abab[oa, ob, oa, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ijcl,ck,klab->abji', g_abab[oa, ob, va, ob], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ijlc,ck,lkab->abji', g_abab[oa, ob, oa, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ljak,cl,ikcb->abji', g_abab[oa, ob, va, ob], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ljkb,cl,ikca->abji', g_abab[oa, ob, oa, vb], t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('jlbk,cl,ikac->abji', g_bbbb[ob, ob, vb, ob], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('ilak,cl,kjcb->abji', g_aaaa[oa, oa, va, oa], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ilak,cl,jkcb->abji', g_abab[oa, ob, va, ob], t1_bb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ilkb,cl,kjac->abji', g_abab[oa, ob, oa, vb], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('kcda,dk,ijcb->abji', g_aaaa[oa, va, va, va], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ckad,dk,ijcb->abji', g_abab[va, ob, va, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('kcdb,dk,ijac->abji', g_abab[oa, vb, va, vb], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('kcdb,dk,ijac->abji', g_bbbb[ob, vb, vb, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('cjad,dk,ikcb->abji', g_abab[va, ob, va, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('cjdb,dk,ikca->abji', g_abab[va, ob, va, vb], t1_aa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('jcdb,dk,ikac->abji', g_bbbb[ob, vb, vb, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('icda,dk,kjcb->abji', g_aaaa[oa, va, va, va], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('icad,dk,jkcb->abji', g_abab[oa, vb, va, vb], t1_bb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('icdb,dk,kjac->abji', g_abab[oa, vb, va, vb], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('kdab,ck,ijcd->abji', g_abab[oa, vb, va, vb], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('dkab,ck,ijdc->abji', g_abab[va, ob, va, vb], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab +=  0.250 * einsum('lkcd,cdlk,ijab->abji', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.250 * einsum('lkcd,cdlk,ijab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.250 * einsum('klcd,cdkl,ijab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.250 * einsum('lkdc,dclk,ijab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.250 * einsum('kldc,dckl,ijab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.250 * einsum('lkcd,cdlk,ijab->abji', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('ljcd,cdlk,ikab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('ljdc,dclk,ikab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('jlcd,cdkl,ikab->abji', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('ilcd,cdkl,kjab->abji', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('ilcd,cdkl,kjab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('ildc,dckl,kjab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.250 * einsum('ijcd,cdkl,klab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.250 * einsum('ijcd,cdlk,lkab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.250 * einsum('ijdc,dckl,klab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.250 * einsum('ijdc,dclk,lkab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('lkda,dclk,ijcb->abji', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('lkad,cdlk,ijcb->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('klad,cdkl,ijcb->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('lkdb,dclk,ijac->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('kldb,dckl,ijac->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('lkdb,dclk,ijac->abji', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ljad,cdlk,ikcb->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ljdb,dckl,ikca->abji', g_abab[oa, ob, va, vb], t2_aaaa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ljdb,dclk,ikac->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('jldb,cdkl,ikca->abji', g_bbbb[ob, ob, vb, vb], t2_abab, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('jldb,dckl,ikac->abji', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ilda,dckl,kjcb->abji', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ilda,dclk,jkcb->abji', g_aaaa[oa, oa, va, va], t2_abab, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ilad,cdkl,kjcb->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ilad,dckl,jkcb->abji', g_abab[oa, ob, va, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ildb,dckl,kjac->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('ijad,cdkl,klcb->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('ijad,cdlk,lkcb->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab +=  0.50 * einsum('ijad,dckl,klcb->abji', g_abab[oa, ob, va, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab +=  0.50 * einsum('ijdb,dckl,klca->abji', g_abab[oa, ob, va, vb], t2_aaaa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('ijdb,dckl,klac->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('ijdb,dclk,lkac->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab +=  0.250 * einsum('lkab,dclk,ijdc->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.250 * einsum('klab,dckl,ijdc->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.250 * einsum('lkab,cdlk,ijcd->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.250 * einsum('klab,cdkl,ijcd->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.50 * einsum('ljab,dckl,ikdc->abji', g_abab[oa, ob, va, vb], t2_aaaa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('ljab,dclk,ikdc->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('ljab,cdlk,ikcd->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('ilab,dckl,kjdc->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('ilab,cdkl,kjcd->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab +=  0.50 * einsum('ilab,dckl,jkdc->abji', g_abab[oa, ob, va, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('lkcd,ck,dl,ijab->abji', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_abab +=  0.50 * einsum('klcd,ck,dl,ijab->abji', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_abab +=  0.50 * einsum('lkdc,ck,dl,ijab->abji', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_abab += -0.50 * einsum('lkcd,ck,dl,ijab->abji', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('ljcd,cl,dk,ikab->abji', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('jlcd,cl,dk,ikab->abji', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ilcd,cl,dk,kjab->abji', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('ildc,cl,dk,kjab->abji', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('lkda,cl,dk,ijcb->abji', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 2), (0, 2), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('lkad,cl,dk,ijcb->abji', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 2), (0, 1)])
    lambda_doubles_res_abab += -1.00 * einsum('kldb,cl,dk,ijac->abji', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('lkdb,cl,dk,ijac->abji', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.50 * einsum('ijcd,cl,dk,lkab->abji', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.50 * einsum('ijdc,cl,dk,klab->abji', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ljad,cl,dk,ikcb->abji', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ljdb,cl,dk,ikca->abji', g_abab[oa, ob, va, vb], t1_aa, t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('jldb,cl,dk,ikac->abji', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ilda,cl,dk,kjcb->abji', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ilad,cl,dk,jkcb->abji', g_abab[oa, ob, va, vb], t1_bb, t1_bb, l2_bbbb, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  1.00 * einsum('ildb,cl,dk,kjac->abji', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (1, 3), (1, 2), (0, 1)])
    lambda_doubles_res_abab +=  0.50 * einsum('lkab,cl,dk,ijcd->abji', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_abab +=  0.50 * einsum('klab,cl,dk,ijdc->abji', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    return lambda_doubles_res_abab


def get_lambda_doubles_res_abba(
    uhf_scf_data: Intermediates,
    uhf_ccsd_data: UHF_CCSD_Data,
) -> NDArray:
    f_aa = uhf_scf_data.f_aa
    f_bb = uhf_scf_data.f_bb
    g_aaaa = uhf_scf_data.g_aaaa
    g_abab = uhf_scf_data.g_abab
    g_bbbb = uhf_scf_data.g_bbbb
    va = uhf_scf_data.va
    vb = uhf_scf_data.vb
    oa = uhf_scf_data.oa
    ob = uhf_scf_data.ob
    t1_aa = uhf_ccsd_data.t1_aa
    t1_bb = uhf_ccsd_data.t1_bb
    t2_aaaa = uhf_ccsd_data.t2_aaaa
    t2_abab = uhf_ccsd_data.t2_abab
    t2_bbbb = uhf_ccsd_data.t2_bbbb
    if uhf_ccsd_data.lmbda is None:
        raise RuntimeError("Lambda amplitues missing in UHF_CCSD_Data")
    l1_aa = uhf_ccsd_data.lmbda.l1_aa
    l1_bb = uhf_ccsd_data.lmbda.l1_bb
    l2_aaaa = uhf_ccsd_data.lmbda.l2_aaaa
    l2_abab = uhf_ccsd_data.lmbda.l2_abab
    l2_bbbb = uhf_ccsd_data.lmbda.l2_bbbb
    
    lambda_doubles_res_abba = -1.00 * einsum('ja,ib->abji', f_aa[oa, va], l1_bb)
    lambda_doubles_res_abba += -1.00 * einsum('ib,ja->abji', f_bb[ob, vb], l1_aa)
    lambda_doubles_res_abba += -1.00 * einsum('kk,jiab->abji', f_aa[oa, oa], l2_abab)
    lambda_doubles_res_abba += -1.00 * einsum('kk,jiab->abji', f_bb[ob, ob], l2_abab)
    lambda_doubles_res_abba +=  1.00 * einsum('jk,kiab->abji', f_aa[oa, oa], l2_abab)
    lambda_doubles_res_abba +=  1.00 * einsum('ik,jkab->abji', f_bb[ob, ob], l2_abab)
    lambda_doubles_res_abba += -1.00 * einsum('ca,jicb->abji', f_aa[va, va], l2_abab)
    lambda_doubles_res_abba += -1.00 * einsum('cb,jiac->abji', f_bb[vb, vb], l2_abab)
    lambda_doubles_res_abba += -1.00 * einsum('kc,ck,jiab->abji', f_aa[oa, va], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('kc,ck,jiab->abji', f_bb[ob, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('jc,ck,kiab->abji', f_aa[oa, va], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('ic,ck,jkab->abji', f_bb[ob, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('ka,ck,jicb->abji', f_aa[oa, va], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('kb,ck,jiac->abji', f_bb[ob, vb], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('lklk,jiab->abji', g_aaaa[oa, oa, oa, oa], l2_abab)
    lambda_doubles_res_abba +=  0.50 * einsum('lklk,jiab->abji', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_abba +=  0.50 * einsum('klkl,jiab->abji', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_abba +=  0.50 * einsum('lklk,jiab->abji', g_bbbb[ob, ob, ob, ob], l2_abab)
    lambda_doubles_res_abba += -1.00 * einsum('jiab->abji', g_abab[oa, ob, va, vb])
    lambda_doubles_res_abba +=  1.00 * einsum('jiak,kb->abji', g_abab[oa, ob, va, ob], l1_bb)
    lambda_doubles_res_abba +=  1.00 * einsum('jikb,ka->abji', g_abab[oa, ob, oa, vb], l1_aa)
    lambda_doubles_res_abba += -1.00 * einsum('jcab,ic->abji', g_abab[oa, vb, va, vb], l1_bb)
    lambda_doubles_res_abba += -1.00 * einsum('ciab,jc->abji', g_abab[va, ob, va, vb], l1_aa)
    lambda_doubles_res_abba += -0.50 * einsum('jikl,klab->abji', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_abba += -0.50 * einsum('jilk,lkab->abji', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_abba += -1.00 * einsum('jcak,kicb->abji', g_aaaa[oa, va, va, oa], l2_abab)
    lambda_doubles_res_abba +=  1.00 * einsum('jcak,ikcb->abji', g_abab[oa, vb, va, ob], l2_bbbb)
    lambda_doubles_res_abba +=  1.00 * einsum('jckb,kiac->abji', g_abab[oa, vb, oa, vb], l2_abab)
    lambda_doubles_res_abba +=  1.00 * einsum('ciak,jkcb->abji', g_abab[va, ob, va, ob], l2_abab)
    lambda_doubles_res_abba +=  1.00 * einsum('cikb,jkca->abji', g_abab[va, ob, oa, vb], l2_aaaa)
    lambda_doubles_res_abba += -1.00 * einsum('icbk,jkac->abji', g_bbbb[ob, vb, vb, ob], l2_abab)
    lambda_doubles_res_abba += -0.50 * einsum('dcab,jidc->abji', g_abab[va, vb, va, vb], l2_abab)
    lambda_doubles_res_abba += -0.50 * einsum('cdab,jicd->abji', g_abab[va, vb, va, vb], l2_abab)
    lambda_doubles_res_abba +=  1.00 * einsum('jkca,ck,ib->abji', g_aaaa[oa, oa, va, va], t1_aa, l1_bb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('jkac,ck,ib->abji', g_abab[oa, ob, va, vb], t1_bb, l1_bb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('kicb,ck,ja->abji', g_abab[oa, ob, va, vb], t1_aa, l1_aa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('ikcb,ck,ja->abji', g_bbbb[ob, ob, vb, vb], t1_bb, l1_aa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('jiac,ck,kb->abji', g_abab[oa, ob, va, vb], t1_bb, l1_bb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('jicb,ck,ka->abji', g_abab[oa, ob, va, vb], t1_aa, l1_aa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('jkab,ck,ic->abji', g_abab[oa, ob, va, vb], t1_bb, l1_bb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('kiab,ck,jc->abji', g_abab[oa, ob, va, vb], t1_aa, l1_aa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('jlck,cl,kiab->abji', g_aaaa[oa, oa, va, oa], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('jlkc,cl,kiab->abji', g_abab[oa, ob, oa, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('lick,cl,jkab->abji', g_abab[oa, ob, va, ob], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('ilck,cl,jkab->abji', g_bbbb[ob, ob, vb, ob], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('jicl,ck,klab->abji', g_abab[oa, ob, va, ob], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('jilc,ck,lkab->abji', g_abab[oa, ob, oa, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('jlak,cl,kicb->abji', g_aaaa[oa, oa, va, oa], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('jlak,cl,ikcb->abji', g_abab[oa, ob, va, ob], t1_bb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('jlkb,cl,kiac->abji', g_abab[oa, ob, oa, vb], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('liak,cl,jkcb->abji', g_abab[oa, ob, va, ob], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('likb,cl,jkca->abji', g_abab[oa, ob, oa, vb], t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('ilbk,cl,jkac->abji', g_bbbb[ob, ob, vb, ob], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('kcda,dk,jicb->abji', g_aaaa[oa, va, va, va], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('ckad,dk,jicb->abji', g_abab[va, ob, va, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('kcdb,dk,jiac->abji', g_abab[oa, vb, va, vb], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('kcdb,dk,jiac->abji', g_bbbb[ob, vb, vb, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('jcda,dk,kicb->abji', g_aaaa[oa, va, va, va], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('jcad,dk,ikcb->abji', g_abab[oa, vb, va, vb], t1_bb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('jcdb,dk,kiac->abji', g_abab[oa, vb, va, vb], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('ciad,dk,jkcb->abji', g_abab[va, ob, va, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('cidb,dk,jkca->abji', g_abab[va, ob, va, vb], t1_aa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('icdb,dk,jkac->abji', g_bbbb[ob, vb, vb, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('kdab,ck,jicd->abji', g_abab[oa, vb, va, vb], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('dkab,ck,jidc->abji', g_abab[va, ob, va, vb], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba += -0.250 * einsum('lkcd,cdlk,jiab->abji', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.250 * einsum('lkcd,cdlk,jiab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.250 * einsum('klcd,cdkl,jiab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.250 * einsum('lkdc,dclk,jiab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.250 * einsum('kldc,dckl,jiab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.250 * einsum('lkcd,cdlk,jiab->abji', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('jlcd,cdkl,kiab->abji', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('jlcd,cdkl,kiab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('jldc,dckl,kiab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('licd,cdlk,jkab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('lidc,dclk,jkab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('ilcd,cdkl,jkab->abji', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.250 * einsum('jicd,cdkl,klab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.250 * einsum('jicd,cdlk,lkab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.250 * einsum('jidc,dckl,klab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.250 * einsum('jidc,dclk,lkab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('lkda,dclk,jicb->abji', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('lkad,cdlk,jicb->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('klad,cdkl,jicb->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('lkdb,dclk,jiac->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('kldb,dckl,jiac->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('lkdb,dclk,jiac->abji', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('jlda,dckl,kicb->abji', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('jlda,dclk,ikcb->abji', g_aaaa[oa, oa, va, va], t2_abab, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('jlad,cdkl,kicb->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('jlad,dckl,ikcb->abji', g_abab[oa, ob, va, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('jldb,dckl,kiac->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('liad,cdlk,jkcb->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('lidb,dckl,jkca->abji', g_abab[oa, ob, va, vb], t2_aaaa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('lidb,dclk,jkac->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('ildb,cdkl,jkca->abji', g_bbbb[ob, ob, vb, vb], t2_abab, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('ildb,dckl,jkac->abji', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('jiad,cdkl,klcb->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('jiad,cdlk,lkcb->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba += -0.50 * einsum('jiad,dckl,klcb->abji', g_abab[oa, ob, va, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba += -0.50 * einsum('jidb,dckl,klca->abji', g_abab[oa, ob, va, vb], t2_aaaa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('jidb,dckl,klac->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('jidb,dclk,lkac->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba += -0.250 * einsum('lkab,dclk,jidc->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.250 * einsum('klab,dckl,jidc->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.250 * einsum('lkab,cdlk,jicd->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.250 * einsum('klab,cdkl,jicd->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('jlab,dckl,kidc->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('jlab,cdkl,kicd->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba += -0.50 * einsum('jlab,dckl,ikdc->abji', g_abab[oa, ob, va, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba += -0.50 * einsum('liab,dckl,jkdc->abji', g_abab[oa, ob, va, vb], t2_aaaa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('liab,dclk,jkdc->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('liab,cdlk,jkcd->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('lkcd,ck,dl,jiab->abji', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_abba += -0.50 * einsum('klcd,ck,dl,jiab->abji', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_abba += -0.50 * einsum('lkdc,ck,dl,jiab->abji', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_abba +=  0.50 * einsum('lkcd,ck,dl,jiab->abji', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('jlcd,cl,dk,kiab->abji', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('jldc,cl,dk,kiab->abji', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('licd,cl,dk,jkab->abji', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('ilcd,cl,dk,jkab->abji', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('lkda,cl,dk,jicb->abji', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 2), (0, 2), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('lkad,cl,dk,jicb->abji', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 2), (0, 1)])
    lambda_doubles_res_abba +=  1.00 * einsum('kldb,cl,dk,jiac->abji', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('lkdb,cl,dk,jiac->abji', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.50 * einsum('jicd,cl,dk,lkab->abji', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.50 * einsum('jidc,cl,dk,klab->abji', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('jlda,cl,dk,kicb->abji', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('jlad,cl,dk,ikcb->abji', g_abab[oa, ob, va, vb], t1_bb, t1_bb, l2_bbbb, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('jldb,cl,dk,kiac->abji', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (1, 3), (1, 2), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('liad,cl,dk,jkcb->abji', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('lidb,cl,dk,jkca->abji', g_abab[oa, ob, va, vb], t1_aa, t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_abba += -1.00 * einsum('ildb,cl,dk,jkac->abji', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.50 * einsum('lkab,cl,dk,jicd->abji', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_abba += -0.50 * einsum('klab,cl,dk,jidc->abji', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    return lambda_doubles_res_abba


def get_lambda_doubles_res_baab(
    uhf_scf_data: Intermediates,
    uhf_ccsd_data: UHF_CCSD_Data,
) -> NDArray:
    f_aa = uhf_scf_data.f_aa
    f_bb = uhf_scf_data.f_bb
    g_aaaa = uhf_scf_data.g_aaaa
    g_abab = uhf_scf_data.g_abab
    g_bbbb = uhf_scf_data.g_bbbb
    va = uhf_scf_data.va
    vb = uhf_scf_data.vb
    oa = uhf_scf_data.oa
    ob = uhf_scf_data.ob
    t1_aa = uhf_ccsd_data.t1_aa
    t1_bb = uhf_ccsd_data.t1_bb
    t2_aaaa = uhf_ccsd_data.t2_aaaa
    t2_abab = uhf_ccsd_data.t2_abab
    t2_bbbb = uhf_ccsd_data.t2_bbbb
    if uhf_ccsd_data.lmbda is None:
        raise RuntimeError("Lambda amplitues missing in UHF_CCSD_Data")
    l1_aa = uhf_ccsd_data.lmbda.l1_aa
    l1_bb = uhf_ccsd_data.lmbda.l1_bb
    l2_aaaa = uhf_ccsd_data.lmbda.l2_aaaa
    l2_abab = uhf_ccsd_data.lmbda.l2_abab
    l2_bbbb = uhf_ccsd_data.lmbda.l2_bbbb
    
    lambda_doubles_res_baab = -1.00 * einsum('ja,ib->abji', f_bb[ob, vb], l1_aa)
    lambda_doubles_res_baab += -1.00 * einsum('ib,ja->abji', f_aa[oa, va], l1_bb)
    lambda_doubles_res_baab += -1.00 * einsum('kk,ijba->abji', f_aa[oa, oa], l2_abab)
    lambda_doubles_res_baab += -1.00 * einsum('kk,ijba->abji', f_bb[ob, ob], l2_abab)
    lambda_doubles_res_baab +=  1.00 * einsum('jk,ikba->abji', f_bb[ob, ob], l2_abab)
    lambda_doubles_res_baab +=  1.00 * einsum('ik,kjba->abji', f_aa[oa, oa], l2_abab)
    lambda_doubles_res_baab += -1.00 * einsum('ca,ijbc->abji', f_bb[vb, vb], l2_abab)
    lambda_doubles_res_baab += -1.00 * einsum('cb,ijca->abji', f_aa[va, va], l2_abab)
    lambda_doubles_res_baab += -1.00 * einsum('kc,ck,ijba->abji', f_aa[oa, va], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('kc,ck,ijba->abji', f_bb[ob, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('jc,ck,ikba->abji', f_bb[ob, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('ic,ck,kjba->abji', f_aa[oa, va], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('ka,ck,ijbc->abji', f_bb[ob, vb], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('kb,ck,ijca->abji', f_aa[oa, va], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('lklk,ijba->abji', g_aaaa[oa, oa, oa, oa], l2_abab)
    lambda_doubles_res_baab +=  0.50 * einsum('lklk,ijba->abji', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_baab +=  0.50 * einsum('klkl,ijba->abji', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_baab +=  0.50 * einsum('lklk,ijba->abji', g_bbbb[ob, ob, ob, ob], l2_abab)
    lambda_doubles_res_baab += -1.00 * einsum('ijba->abji', g_abab[oa, ob, va, vb])
    lambda_doubles_res_baab +=  1.00 * einsum('ijka,kb->abji', g_abab[oa, ob, oa, vb], l1_aa)
    lambda_doubles_res_baab +=  1.00 * einsum('ijbk,ka->abji', g_abab[oa, ob, va, ob], l1_bb)
    lambda_doubles_res_baab += -1.00 * einsum('cjba,ic->abji', g_abab[va, ob, va, vb], l1_aa)
    lambda_doubles_res_baab += -1.00 * einsum('icba,jc->abji', g_abab[oa, vb, va, vb], l1_bb)
    lambda_doubles_res_baab += -0.50 * einsum('ijkl,klba->abji', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_baab += -0.50 * einsum('ijlk,lkba->abji', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_baab +=  1.00 * einsum('cjka,ikcb->abji', g_abab[va, ob, oa, vb], l2_aaaa)
    lambda_doubles_res_baab += -1.00 * einsum('jcak,ikbc->abji', g_bbbb[ob, vb, vb, ob], l2_abab)
    lambda_doubles_res_baab +=  1.00 * einsum('cjbk,ikca->abji', g_abab[va, ob, va, ob], l2_abab)
    lambda_doubles_res_baab +=  1.00 * einsum('icka,kjbc->abji', g_abab[oa, vb, oa, vb], l2_abab)
    lambda_doubles_res_baab += -1.00 * einsum('icbk,kjca->abji', g_aaaa[oa, va, va, oa], l2_abab)
    lambda_doubles_res_baab +=  1.00 * einsum('icbk,jkca->abji', g_abab[oa, vb, va, ob], l2_bbbb)
    lambda_doubles_res_baab += -0.50 * einsum('dcba,ijdc->abji', g_abab[va, vb, va, vb], l2_abab)
    lambda_doubles_res_baab += -0.50 * einsum('cdba,ijcd->abji', g_abab[va, vb, va, vb], l2_abab)
    lambda_doubles_res_baab += -1.00 * einsum('kjca,ck,ib->abji', g_abab[oa, ob, va, vb], t1_aa, l1_aa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('jkca,ck,ib->abji', g_bbbb[ob, ob, vb, vb], t1_bb, l1_aa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('ikcb,ck,ja->abji', g_aaaa[oa, oa, va, va], t1_aa, l1_bb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('ikbc,ck,ja->abji', g_abab[oa, ob, va, vb], t1_bb, l1_bb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('ijca,ck,kb->abji', g_abab[oa, ob, va, vb], t1_aa, l1_aa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('ijbc,ck,ka->abji', g_abab[oa, ob, va, vb], t1_bb, l1_bb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('kjba,ck,ic->abji', g_abab[oa, ob, va, vb], t1_aa, l1_aa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('ikba,ck,jc->abji', g_abab[oa, ob, va, vb], t1_bb, l1_bb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('ljck,cl,ikba->abji', g_abab[oa, ob, va, ob], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('jlck,cl,ikba->abji', g_bbbb[ob, ob, vb, ob], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('ilck,cl,kjba->abji', g_aaaa[oa, oa, va, oa], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('ilkc,cl,kjba->abji', g_abab[oa, ob, oa, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('ijcl,ck,klba->abji', g_abab[oa, ob, va, ob], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('ijlc,ck,lkba->abji', g_abab[oa, ob, oa, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('ljka,cl,ikcb->abji', g_abab[oa, ob, oa, vb], t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('jlak,cl,ikbc->abji', g_bbbb[ob, ob, vb, ob], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('ljbk,cl,ikca->abji', g_abab[oa, ob, va, ob], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('ilka,cl,kjbc->abji', g_abab[oa, ob, oa, vb], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('ilbk,cl,kjca->abji', g_aaaa[oa, oa, va, oa], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('ilbk,cl,jkca->abji', g_abab[oa, ob, va, ob], t1_bb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('kcda,dk,ijbc->abji', g_abab[oa, vb, va, vb], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('kcda,dk,ijbc->abji', g_bbbb[ob, vb, vb, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('kcdb,dk,ijca->abji', g_aaaa[oa, va, va, va], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('ckbd,dk,ijca->abji', g_abab[va, ob, va, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('cjda,dk,ikcb->abji', g_abab[va, ob, va, vb], t1_aa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('jcda,dk,ikbc->abji', g_bbbb[ob, vb, vb, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('cjbd,dk,ikca->abji', g_abab[va, ob, va, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('icda,dk,kjbc->abji', g_abab[oa, vb, va, vb], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('icdb,dk,kjca->abji', g_aaaa[oa, va, va, va], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('icbd,dk,jkca->abji', g_abab[oa, vb, va, vb], t1_bb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('kdba,ck,ijcd->abji', g_abab[oa, vb, va, vb], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('dkba,ck,ijdc->abji', g_abab[va, ob, va, vb], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab += -0.250 * einsum('lkcd,cdlk,ijba->abji', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.250 * einsum('lkcd,cdlk,ijba->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.250 * einsum('klcd,cdkl,ijba->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.250 * einsum('lkdc,dclk,ijba->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.250 * einsum('kldc,dckl,ijba->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.250 * einsum('lkcd,cdlk,ijba->abji', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('ljcd,cdlk,ikba->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('ljdc,dclk,ikba->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('jlcd,cdkl,ikba->abji', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('ilcd,cdkl,kjba->abji', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('ilcd,cdkl,kjba->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('ildc,dckl,kjba->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.250 * einsum('ijcd,cdkl,klba->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.250 * einsum('ijcd,cdlk,lkba->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.250 * einsum('ijdc,dckl,klba->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.250 * einsum('ijdc,dclk,lkba->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('lkda,dclk,ijbc->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('klda,dckl,ijbc->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('lkda,dclk,ijbc->abji', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('lkdb,dclk,ijca->abji', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('lkbd,cdlk,ijca->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('klbd,cdkl,ijca->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('ljda,dckl,ikcb->abji', g_abab[oa, ob, va, vb], t2_aaaa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('ljda,dclk,ikbc->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('jlda,cdkl,ikcb->abji', g_bbbb[ob, ob, vb, vb], t2_abab, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('jlda,dckl,ikbc->abji', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('ljbd,cdlk,ikca->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('ilda,dckl,kjbc->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('ildb,dckl,kjca->abji', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('ildb,dclk,jkca->abji', g_aaaa[oa, oa, va, va], t2_abab, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('ilbd,cdkl,kjca->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('ilbd,dckl,jkca->abji', g_abab[oa, ob, va, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.50 * einsum('ijda,dckl,klcb->abji', g_abab[oa, ob, va, vb], t2_aaaa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('ijda,dckl,klbc->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('ijda,dclk,lkbc->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('ijbd,cdkl,klca->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('ijbd,cdlk,lkca->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab += -0.50 * einsum('ijbd,dckl,klca->abji', g_abab[oa, ob, va, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab += -0.250 * einsum('lkba,dclk,ijdc->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.250 * einsum('klba,dckl,ijdc->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.250 * einsum('lkba,cdlk,ijcd->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.250 * einsum('klba,cdkl,ijcd->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.50 * einsum('ljba,dckl,ikdc->abji', g_abab[oa, ob, va, vb], t2_aaaa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('ljba,dclk,ikdc->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('ljba,cdlk,ikcd->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('ilba,dckl,kjdc->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('ilba,cdkl,kjcd->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab += -0.50 * einsum('ilba,dckl,jkdc->abji', g_abab[oa, ob, va, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('lkcd,ck,dl,ijba->abji', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_baab += -0.50 * einsum('klcd,ck,dl,ijba->abji', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_baab += -0.50 * einsum('lkdc,ck,dl,ijba->abji', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_baab +=  0.50 * einsum('lkcd,ck,dl,ijba->abji', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('ljcd,cl,dk,ikba->abji', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('jlcd,cl,dk,ikba->abji', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('ilcd,cl,dk,kjba->abji', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('ildc,cl,dk,kjba->abji', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('klda,cl,dk,ijbc->abji', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('lkda,cl,dk,ijbc->abji', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('lkdb,cl,dk,ijca->abji', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 2), (0, 2), (0, 1)])
    lambda_doubles_res_baab +=  1.00 * einsum('lkbd,cl,dk,ijca->abji', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 2), (0, 1)])
    lambda_doubles_res_baab += -0.50 * einsum('ijcd,cl,dk,lkba->abji', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.50 * einsum('ijdc,cl,dk,klba->abji', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('ljda,cl,dk,ikcb->abji', g_abab[oa, ob, va, vb], t1_aa, t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('jlda,cl,dk,ikbc->abji', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('ljbd,cl,dk,ikca->abji', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('ilda,cl,dk,kjbc->abji', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (1, 3), (1, 2), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('ildb,cl,dk,kjca->abji', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_baab += -1.00 * einsum('ilbd,cl,dk,jkca->abji', g_abab[oa, ob, va, vb], t1_bb, t1_bb, l2_bbbb, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.50 * einsum('lkba,cl,dk,ijcd->abji', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_baab += -0.50 * einsum('klba,cl,dk,ijdc->abji', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    return lambda_doubles_res_baab


def get_lambda_doubles_res_baba(
    uhf_scf_data: Intermediates,
    uhf_ccsd_data: UHF_CCSD_Data,
) -> NDArray:
    f_aa = uhf_scf_data.f_aa
    f_bb = uhf_scf_data.f_bb
    g_aaaa = uhf_scf_data.g_aaaa
    g_abab = uhf_scf_data.g_abab
    g_bbbb = uhf_scf_data.g_bbbb
    va = uhf_scf_data.va
    vb = uhf_scf_data.vb
    oa = uhf_scf_data.oa
    ob = uhf_scf_data.ob
    t1_aa = uhf_ccsd_data.t1_aa
    t1_bb = uhf_ccsd_data.t1_bb
    t2_aaaa = uhf_ccsd_data.t2_aaaa
    t2_abab = uhf_ccsd_data.t2_abab
    t2_bbbb = uhf_ccsd_data.t2_bbbb
    if uhf_ccsd_data.lmbda is None:
        raise RuntimeError("Lambda amplitues missing in UHF_CCSD_Data")
    l1_aa = uhf_ccsd_data.lmbda.l1_aa
    l1_bb = uhf_ccsd_data.lmbda.l1_bb
    l2_aaaa = uhf_ccsd_data.lmbda.l2_aaaa
    l2_abab = uhf_ccsd_data.lmbda.l2_abab
    l2_bbbb = uhf_ccsd_data.lmbda.l2_bbbb
    
    lambda_doubles_res_baba =  1.00 * einsum('jb,ia->abji', f_aa[oa, va], l1_bb)
    lambda_doubles_res_baba +=  1.00 * einsum('ia,jb->abji', f_bb[ob, vb], l1_aa)
    lambda_doubles_res_baba +=  1.00 * einsum('kk,jiba->abji', f_aa[oa, oa], l2_abab)
    lambda_doubles_res_baba +=  1.00 * einsum('kk,jiba->abji', f_bb[ob, ob], l2_abab)
    lambda_doubles_res_baba += -1.00 * einsum('jk,kiba->abji', f_aa[oa, oa], l2_abab)
    lambda_doubles_res_baba += -1.00 * einsum('ik,jkba->abji', f_bb[ob, ob], l2_abab)
    lambda_doubles_res_baba +=  1.00 * einsum('ca,jibc->abji', f_bb[vb, vb], l2_abab)
    lambda_doubles_res_baba +=  1.00 * einsum('cb,jica->abji', f_aa[va, va], l2_abab)
    lambda_doubles_res_baba +=  1.00 * einsum('kc,ck,jiba->abji', f_aa[oa, va], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('kc,ck,jiba->abji', f_bb[ob, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('jc,ck,kiba->abji', f_aa[oa, va], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('ic,ck,jkba->abji', f_bb[ob, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('ka,ck,jibc->abji', f_bb[ob, vb], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('kb,ck,jica->abji', f_aa[oa, va], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('lklk,jiba->abji', g_aaaa[oa, oa, oa, oa], l2_abab)
    lambda_doubles_res_baba += -0.50 * einsum('lklk,jiba->abji', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_baba += -0.50 * einsum('klkl,jiba->abji', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_baba += -0.50 * einsum('lklk,jiba->abji', g_bbbb[ob, ob, ob, ob], l2_abab)
    lambda_doubles_res_baba +=  1.00 * einsum('jiba->abji', g_abab[oa, ob, va, vb])
    lambda_doubles_res_baba += -1.00 * einsum('jika,kb->abji', g_abab[oa, ob, oa, vb], l1_aa)
    lambda_doubles_res_baba += -1.00 * einsum('jibk,ka->abji', g_abab[oa, ob, va, ob], l1_bb)
    lambda_doubles_res_baba +=  1.00 * einsum('jcba,ic->abji', g_abab[oa, vb, va, vb], l1_bb)
    lambda_doubles_res_baba +=  1.00 * einsum('ciba,jc->abji', g_abab[va, ob, va, vb], l1_aa)
    lambda_doubles_res_baba +=  0.50 * einsum('jikl,klba->abji', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_baba +=  0.50 * einsum('jilk,lkba->abji', g_abab[oa, ob, oa, ob], l2_abab)
    lambda_doubles_res_baba += -1.00 * einsum('jcka,kibc->abji', g_abab[oa, vb, oa, vb], l2_abab)
    lambda_doubles_res_baba +=  1.00 * einsum('jcbk,kica->abji', g_aaaa[oa, va, va, oa], l2_abab)
    lambda_doubles_res_baba += -1.00 * einsum('jcbk,ikca->abji', g_abab[oa, vb, va, ob], l2_bbbb)
    lambda_doubles_res_baba += -1.00 * einsum('cika,jkcb->abji', g_abab[va, ob, oa, vb], l2_aaaa)
    lambda_doubles_res_baba +=  1.00 * einsum('icak,jkbc->abji', g_bbbb[ob, vb, vb, ob], l2_abab)
    lambda_doubles_res_baba += -1.00 * einsum('cibk,jkca->abji', g_abab[va, ob, va, ob], l2_abab)
    lambda_doubles_res_baba +=  0.50 * einsum('dcba,jidc->abji', g_abab[va, vb, va, vb], l2_abab)
    lambda_doubles_res_baba +=  0.50 * einsum('cdba,jicd->abji', g_abab[va, vb, va, vb], l2_abab)
    lambda_doubles_res_baba += -1.00 * einsum('jkcb,ck,ia->abji', g_aaaa[oa, oa, va, va], t1_aa, l1_bb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('jkbc,ck,ia->abji', g_abab[oa, ob, va, vb], t1_bb, l1_bb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('kica,ck,jb->abji', g_abab[oa, ob, va, vb], t1_aa, l1_aa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('ikca,ck,jb->abji', g_bbbb[ob, ob, vb, vb], t1_bb, l1_aa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('jica,ck,kb->abji', g_abab[oa, ob, va, vb], t1_aa, l1_aa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('jibc,ck,ka->abji', g_abab[oa, ob, va, vb], t1_bb, l1_bb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('jkba,ck,ic->abji', g_abab[oa, ob, va, vb], t1_bb, l1_bb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('kiba,ck,jc->abji', g_abab[oa, ob, va, vb], t1_aa, l1_aa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('jlck,cl,kiba->abji', g_aaaa[oa, oa, va, oa], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('jlkc,cl,kiba->abji', g_abab[oa, ob, oa, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('lick,cl,jkba->abji', g_abab[oa, ob, va, ob], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('ilck,cl,jkba->abji', g_bbbb[ob, ob, vb, ob], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('jicl,ck,klba->abji', g_abab[oa, ob, va, ob], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('jilc,ck,lkba->abji', g_abab[oa, ob, oa, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('jlka,cl,kibc->abji', g_abab[oa, ob, oa, vb], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('jlbk,cl,kica->abji', g_aaaa[oa, oa, va, oa], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('jlbk,cl,ikca->abji', g_abab[oa, ob, va, ob], t1_bb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('lika,cl,jkcb->abji', g_abab[oa, ob, oa, vb], t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('ilak,cl,jkbc->abji', g_bbbb[ob, ob, vb, ob], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('libk,cl,jkca->abji', g_abab[oa, ob, va, ob], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('kcda,dk,jibc->abji', g_abab[oa, vb, va, vb], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('kcda,dk,jibc->abji', g_bbbb[ob, vb, vb, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('kcdb,dk,jica->abji', g_aaaa[oa, va, va, va], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('ckbd,dk,jica->abji', g_abab[va, ob, va, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('jcda,dk,kibc->abji', g_abab[oa, vb, va, vb], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('jcdb,dk,kica->abji', g_aaaa[oa, va, va, va], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('jcbd,dk,ikca->abji', g_abab[oa, vb, va, vb], t1_bb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('cida,dk,jkcb->abji', g_abab[va, ob, va, vb], t1_aa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('icda,dk,jkbc->abji', g_bbbb[ob, vb, vb, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('cibd,dk,jkca->abji', g_abab[va, ob, va, vb], t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('kdba,ck,jicd->abji', g_abab[oa, vb, va, vb], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('dkba,ck,jidc->abji', g_abab[va, ob, va, vb], t1_bb, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba +=  0.250 * einsum('lkcd,cdlk,jiba->abji', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  0.250 * einsum('lkcd,cdlk,jiba->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  0.250 * einsum('klcd,cdkl,jiba->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  0.250 * einsum('lkdc,dclk,jiba->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  0.250 * einsum('kldc,dckl,jiba->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  0.250 * einsum('lkcd,cdlk,jiba->abji', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('jlcd,cdkl,kiba->abji', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('jlcd,cdkl,kiba->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('jldc,dckl,kiba->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('licd,cdlk,jkba->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('lidc,dclk,jkba->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('ilcd,cdkl,jkba->abji', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  0.250 * einsum('jicd,cdkl,klba->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  0.250 * einsum('jicd,cdlk,lkba->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  0.250 * einsum('jidc,dckl,klba->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  0.250 * einsum('jidc,dclk,lkba->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('lkda,dclk,jibc->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('klda,dckl,jibc->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('lkda,dclk,jibc->abji', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('lkdb,dclk,jica->abji', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('lkbd,cdlk,jica->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('klbd,cdkl,jica->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('jlda,dckl,kibc->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('jldb,dckl,kica->abji', g_aaaa[oa, oa, va, va], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('jldb,dclk,ikca->abji', g_aaaa[oa, oa, va, va], t2_abab, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('jlbd,cdkl,kica->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('jlbd,dckl,ikca->abji', g_abab[oa, ob, va, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('lida,dckl,jkcb->abji', g_abab[oa, ob, va, vb], t2_aaaa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('lida,dclk,jkbc->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('ilda,cdkl,jkcb->abji', g_bbbb[ob, ob, vb, vb], t2_abab, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('ilda,dckl,jkbc->abji', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('libd,cdlk,jkca->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  0.50 * einsum('jida,dckl,klcb->abji', g_abab[oa, ob, va, vb], t2_aaaa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('jida,dckl,klbc->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('jida,dclk,lkbc->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('jibd,cdkl,klca->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('jibd,cdlk,lkca->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba +=  0.50 * einsum('jibd,dckl,klca->abji', g_abab[oa, ob, va, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba +=  0.250 * einsum('lkba,dclk,jidc->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  0.250 * einsum('klba,dckl,jidc->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  0.250 * einsum('lkba,cdlk,jicd->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  0.250 * einsum('klba,cdkl,jicd->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('jlba,dckl,kidc->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('jlba,cdkl,kicd->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba +=  0.50 * einsum('jlba,dckl,ikdc->abji', g_abab[oa, ob, va, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba +=  0.50 * einsum('liba,dckl,jkdc->abji', g_abab[oa, ob, va, vb], t2_aaaa, l2_aaaa, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('liba,dclk,jkdc->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('liba,cdlk,jkcd->abji', g_abab[oa, ob, va, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('lkcd,ck,dl,jiba->abji', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_baba +=  0.50 * einsum('klcd,ck,dl,jiba->abji', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_baba +=  0.50 * einsum('lkdc,ck,dl,jiba->abji', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_baba += -0.50 * einsum('lkcd,ck,dl,jiba->abji', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('jlcd,cl,dk,kiba->abji', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('jldc,cl,dk,kiba->abji', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('licd,cl,dk,jkba->abji', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('ilcd,cl,dk,jkba->abji', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('klda,cl,dk,jibc->abji', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('lkda,cl,dk,jibc->abji', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('lkdb,cl,dk,jica->abji', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 2), (0, 2), (0, 1)])
    lambda_doubles_res_baba += -1.00 * einsum('lkbd,cl,dk,jica->abji', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 2), (0, 1)])
    lambda_doubles_res_baba +=  0.50 * einsum('jicd,cl,dk,lkba->abji', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  0.50 * einsum('jidc,cl,dk,klba->abji', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('jlda,cl,dk,kibc->abji', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (1, 3), (1, 2), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('jldb,cl,dk,kica->abji', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('jlbd,cl,dk,ikca->abji', g_abab[oa, ob, va, vb], t1_bb, t1_bb, l2_bbbb, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('lida,cl,dk,jkcb->abji', g_abab[oa, ob, va, vb], t1_aa, t1_aa, l2_aaaa, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('ilda,cl,dk,jkbc->abji', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  1.00 * einsum('libd,cl,dk,jkca->abji', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_baba +=  0.50 * einsum('lkba,cl,dk,jicd->abji', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_baba +=  0.50 * einsum('klba,cl,dk,jidc->abji', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_abab, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    return lambda_doubles_res_baba


def get_lambda_doubles_res_bbbb(
    uhf_scf_data: Intermediates,
    uhf_ccsd_data: UHF_CCSD_Data,
) -> NDArray:
    f_aa = uhf_scf_data.f_aa
    f_bb = uhf_scf_data.f_bb
    g_aaaa = uhf_scf_data.g_aaaa
    g_abab = uhf_scf_data.g_abab
    g_bbbb = uhf_scf_data.g_bbbb
    va = uhf_scf_data.va
    vb = uhf_scf_data.vb
    oa = uhf_scf_data.oa
    ob = uhf_scf_data.ob
    t1_aa = uhf_ccsd_data.t1_aa
    t1_bb = uhf_ccsd_data.t1_bb
    t2_aaaa = uhf_ccsd_data.t2_aaaa
    t2_abab = uhf_ccsd_data.t2_abab
    t2_bbbb = uhf_ccsd_data.t2_bbbb
    if uhf_ccsd_data.lmbda is None:
        raise RuntimeError("Lambda amplitues missing in UHF_CCSD_Data")
    l1_aa = uhf_ccsd_data.lmbda.l1_aa
    l1_bb = uhf_ccsd_data.lmbda.l1_bb
    l2_aaaa = uhf_ccsd_data.lmbda.l2_aaaa
    l2_abab = uhf_ccsd_data.lmbda.l2_abab
    l2_bbbb = uhf_ccsd_data.lmbda.l2_bbbb
    
    contracted_intermediate = -1.00 * einsum('ja,ib->abji', f_bb[ob, vb], l1_bb)
    lambda_doubles_res_bbbb =  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate)  + -1.00000 * einsum('abji->baji', contracted_intermediate)  +  1.00000 * einsum('abji->baij', contracted_intermediate) 
    lambda_doubles_res_bbbb +=  1.00 * einsum('kk,ijab->abji', f_aa[oa, oa], l2_bbbb)
    lambda_doubles_res_bbbb +=  1.00 * einsum('kk,ijab->abji', f_bb[ob, ob], l2_bbbb)
    contracted_intermediate = -1.00 * einsum('jk,ikab->abji', f_bb[ob, ob], l2_bbbb)
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('ca,ijcb->abji', f_bb[vb, vb], l2_bbbb)
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->baji', contracted_intermediate) 
    lambda_doubles_res_bbbb +=  1.00 * einsum('kc,ck,ijab->abji', f_aa[oa, va], t1_aa, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00 * einsum('kc,ck,ijab->abji', f_bb[ob, vb], t1_bb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    contracted_intermediate = -1.00 * einsum('jc,ck,ikab->abji', f_bb[ob, vb], t1_bb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('ka,ck,ijcb->abji', f_bb[ob, vb], t1_bb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->baji', contracted_intermediate) 
    lambda_doubles_res_bbbb += -0.50 * einsum('lklk,ijab->abji', g_aaaa[oa, oa, oa, oa], l2_bbbb)
    lambda_doubles_res_bbbb += -0.50 * einsum('lklk,ijab->abji', g_abab[oa, ob, oa, ob], l2_bbbb)
    lambda_doubles_res_bbbb += -0.50 * einsum('klkl,ijab->abji', g_abab[oa, ob, oa, ob], l2_bbbb)
    lambda_doubles_res_bbbb += -0.50 * einsum('lklk,ijab->abji', g_bbbb[ob, ob, ob, ob], l2_bbbb)
    lambda_doubles_res_bbbb +=  1.00 * einsum('ijab->abji', g_bbbb[ob, ob, vb, vb])
    contracted_intermediate = -1.00 * einsum('ijak,kb->abji', g_bbbb[ob, ob, vb, ob], l1_bb)
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->baji', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('jcab,ic->abji', g_bbbb[ob, vb, vb, vb], l1_bb)
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate) 
    lambda_doubles_res_bbbb +=  0.50 * einsum('ijkl,klab->abji', g_bbbb[ob, ob, ob, ob], l2_bbbb)
    contracted_intermediate = -1.00 * einsum('cjka,kicb->abji', g_abab[va, ob, oa, vb], l2_abab)
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate)  + -1.00000 * einsum('abji->baji', contracted_intermediate)  +  1.00000 * einsum('abji->baij', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jcak,ikcb->abji', g_bbbb[ob, vb, vb, ob], l2_bbbb)
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate)  + -1.00000 * einsum('abji->baji', contracted_intermediate)  +  1.00000 * einsum('abji->baij', contracted_intermediate) 
    lambda_doubles_res_bbbb +=  0.50 * einsum('dcab,ijdc->abji', g_bbbb[vb, vb, vb, vb], l2_bbbb)
    contracted_intermediate = -1.00 * einsum('kjca,ck,ib->abji', g_abab[oa, ob, va, vb], t1_aa, l1_bb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate)  + -1.00000 * einsum('abji->baji', contracted_intermediate)  +  1.00000 * einsum('abji->baij', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jkca,ck,ib->abji', g_bbbb[ob, ob, vb, vb], t1_bb, l1_bb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate)  + -1.00000 * einsum('abji->baji', contracted_intermediate)  +  1.00000 * einsum('abji->baij', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('ijca,ck,kb->abji', g_bbbb[ob, ob, vb, vb], t1_bb, l1_bb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->baji', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jkab,ck,ic->abji', g_bbbb[ob, ob, vb, vb], t1_bb, l1_bb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('ljck,cl,ikab->abji', g_abab[oa, ob, va, ob], t1_aa, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jlck,cl,ikab->abji', g_bbbb[ob, ob, vb, ob], t1_bb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate) 
    lambda_doubles_res_bbbb +=  1.00 * einsum('ijcl,ck,klab->abji', g_bbbb[ob, ob, vb, ob], t1_bb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    contracted_intermediate =  1.00 * einsum('ljka,cl,kicb->abji', g_abab[oa, ob, oa, vb], t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate)  + -1.00000 * einsum('abji->baji', contracted_intermediate)  +  1.00000 * einsum('abji->baij', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('jlak,cl,ikcb->abji', g_bbbb[ob, ob, vb, ob], t1_bb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate)  + -1.00000 * einsum('abji->baji', contracted_intermediate)  +  1.00000 * einsum('abji->baij', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('kcda,dk,ijcb->abji', g_abab[oa, vb, va, vb], t1_aa, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->baji', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('kcda,dk,ijcb->abji', g_bbbb[ob, vb, vb, vb], t1_bb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->baji', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('cjda,dk,kicb->abji', g_abab[va, ob, va, vb], t1_aa, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate)  + -1.00000 * einsum('abji->baji', contracted_intermediate)  +  1.00000 * einsum('abji->baij', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('jcda,dk,ikcb->abji', g_bbbb[ob, vb, vb, vb], t1_bb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate)  + -1.00000 * einsum('abji->baji', contracted_intermediate)  +  1.00000 * einsum('abji->baij', contracted_intermediate) 
    lambda_doubles_res_bbbb +=  1.00 * einsum('kdab,ck,ijdc->abji', g_bbbb[ob, vb, vb, vb], t1_bb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_bbbb +=  0.250 * einsum('lkcd,cdlk,ijab->abji', g_aaaa[oa, oa, va, va], t2_aaaa, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  0.250 * einsum('lkcd,cdlk,ijab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  0.250 * einsum('klcd,cdkl,ijab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  0.250 * einsum('lkdc,dclk,ijab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  0.250 * einsum('kldc,dckl,ijab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  0.250 * einsum('lkcd,cdlk,ijab->abji', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    contracted_intermediate = -0.50 * einsum('ljcd,cdlk,ikab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate) 
    contracted_intermediate = -0.50 * einsum('ljdc,dclk,ikab->abji', g_abab[oa, ob, va, vb], t2_abab, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate) 
    contracted_intermediate = -0.50 * einsum('jlcd,cdkl,ikab->abji', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate) 
    lambda_doubles_res_bbbb +=  0.250 * einsum('ijcd,cdkl,klab->abji', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    contracted_intermediate = -0.50 * einsum('lkda,dclk,ijcb->abji', g_abab[oa, ob, va, vb], t2_abab, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->baji', contracted_intermediate) 
    contracted_intermediate = -0.50 * einsum('klda,dckl,ijcb->abji', g_abab[oa, ob, va, vb], t2_abab, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->baji', contracted_intermediate) 
    contracted_intermediate = -0.50 * einsum('lkda,dclk,ijcb->abji', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->baji', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('ljda,dckl,kicb->abji', g_abab[oa, ob, va, vb], t2_aaaa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate)  + -1.00000 * einsum('abji->baji', contracted_intermediate)  +  1.00000 * einsum('abji->baij', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('ljda,dclk,ikcb->abji', g_abab[oa, ob, va, vb], t2_abab, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate)  + -1.00000 * einsum('abji->baji', contracted_intermediate)  +  1.00000 * einsum('abji->baij', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jlda,cdkl,kicb->abji', g_bbbb[ob, ob, vb, vb], t2_abab, l2_abab, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate)  + -1.00000 * einsum('abji->baji', contracted_intermediate)  +  1.00000 * einsum('abji->baij', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jlda,dckl,ikcb->abji', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate)  + -1.00000 * einsum('abji->baji', contracted_intermediate)  +  1.00000 * einsum('abji->baij', contracted_intermediate) 
    contracted_intermediate =  0.50 * einsum('ijda,cdkl,klcb->abji', g_bbbb[ob, ob, vb, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->baji', contracted_intermediate) 
    contracted_intermediate =  0.50 * einsum('ijda,cdlk,lkcb->abji', g_bbbb[ob, ob, vb, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->baji', contracted_intermediate) 
    contracted_intermediate = -0.50 * einsum('ijda,dckl,klcb->abji', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->baji', contracted_intermediate) 
    lambda_doubles_res_bbbb +=  0.250 * einsum('lkab,dclk,ijdc->abji', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    contracted_intermediate =  0.50 * einsum('jlab,dckl,kidc->abji', g_bbbb[ob, ob, vb, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate) 
    contracted_intermediate =  0.50 * einsum('jlab,cdkl,kicd->abji', g_bbbb[ob, ob, vb, vb], t2_abab, l2_abab, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate) 
    contracted_intermediate = -0.50 * einsum('jlab,dckl,ikdc->abji', g_bbbb[ob, ob, vb, vb], t2_bbbb, l2_bbbb, optimize=['einsum_path', (1, 2), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate) 
    lambda_doubles_res_bbbb += -0.50 * einsum('lkcd,ck,dl,ijab->abji', g_aaaa[oa, oa, va, va], t1_aa, t1_aa, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_bbbb +=  0.50 * einsum('klcd,ck,dl,ijab->abji', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_bbbb +=  0.50 * einsum('lkdc,ck,dl,ijab->abji', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_bbbb += -0.50 * einsum('lkcd,ck,dl,ijab->abji', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    contracted_intermediate = -1.00 * einsum('ljcd,cl,dk,ikab->abji', g_abab[oa, ob, va, vb], t1_aa, t1_bb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jlcd,cl,dk,ikab->abji', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate) 
    contracted_intermediate = -1.00 * einsum('klda,cl,dk,ijcb->abji', g_abab[oa, ob, va, vb], t1_bb, t1_aa, l2_bbbb, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->baji', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('lkda,cl,dk,ijcb->abji', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_bbbb, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->baji', contracted_intermediate) 
    lambda_doubles_res_bbbb += -0.50 * einsum('ijcd,cl,dk,klab->abji', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_bbbb, optimize=['einsum_path', (0, 1), (0, 2), (0, 1)])
    contracted_intermediate =  1.00 * einsum('ljda,cl,dk,kicb->abji', g_abab[oa, ob, va, vb], t1_aa, t1_aa, l2_abab, optimize=['einsum_path', (0, 1), (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate)  + -1.00000 * einsum('abji->baji', contracted_intermediate)  +  1.00000 * einsum('abji->baij', contracted_intermediate) 
    contracted_intermediate =  1.00 * einsum('jlda,cl,dk,ikcb->abji', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_bbbb, optimize=['einsum_path', (0, 2), (0, 1), (0, 1)])
    lambda_doubles_res_bbbb +=  1.00000 * contracted_intermediate + -1.00000 * einsum('abji->abij', contracted_intermediate)  + -1.00000 * einsum('abji->baji', contracted_intermediate)  +  1.00000 * einsum('abji->baij', contracted_intermediate) 
    lambda_doubles_res_bbbb += -0.50 * einsum('lkab,cl,dk,ijdc->abji', g_bbbb[ob, ob, vb, vb], t1_bb, t1_bb, l2_bbbb, optimize=['einsum_path', (1, 3), (1, 2), (0, 1)])
    return lambda_doubles_res_bbbb
